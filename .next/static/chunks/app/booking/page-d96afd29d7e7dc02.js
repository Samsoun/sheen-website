(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[355],{3555:function(e,n,t){Promise.resolve().then(t.bind(t,1883))},1883:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var s,r,i=t(7437),a=t(2265),l=t(7648);function o(e){let{customerInfo:n,setCustomerInfo:t,onBack:s,onContinue:r,isLoggedIn:l=!1}=e,[o,c]=(0,a.useState)({fullName:"",email:"",phone:""}),d=e=>{let{name:n,value:s}=e.target;if("fullName"===n){let e=s.replace(/[^a-zA-ZäöüÄÖÜß\s]/g,"");t(t=>({...t,[n]:e}))}else if("phone"===n){let e=s.replace(/[^\d+\s]/g,"");t(t=>({...t,[n]:e}))}else t(e=>({...e,[n]:s}));o[n]&&c(e=>({...e,[n]:""}))},u=()=>{let e=!0,t={fullName:"",email:"",phone:""};return n.fullName.trim()?/^[a-zA-ZäöüÄÖÜß\s]+$/.test(n.fullName)?n.fullName.trim().includes(" ")?n.fullName.trim().split(" ").filter(e=>e.length>0).length<2&&(t.fullName="Bitte geben Sie Vor- und Nachname ein",e=!1):(t.fullName="Bitte geben Sie Vor- und Nachname ein",e=!1):(t.fullName="Der Name darf nur Buchstaben enthalten",e=!1):(t.fullName="Bitte geben Sie Ihren Namen ein",e=!1),n.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)||(t.email="Bitte geben Sie eine g\xfcltige E-Mail-Adresse ein",e=!1):(t.email="Bitte geben Sie Ihre E-Mail-Adresse ein",e=!1),n.phone.trim()?/^[\d+\s]+$/.test(n.phone)||(t.phone="Die Telefonnummer darf nur Zahlen enthalten",e=!1):(t.phone="Bitte geben Sie Ihre Telefonnummer ein",e=!1),c(t),e};return(0,i.jsxs)("div",{className:"booking-form-container",children:[(0,i.jsx)("h3",{className:"heading-tertiary",children:"Pers\xf6nliche Daten"}),l?(0,i.jsx)("p",{className:"booking-step-description",children:"Sie sind angemeldet. Ihre pers\xf6nlichen Daten wurden automatisch ausgef\xfcllt und k\xf6nnen bei Bedarf bearbeitet werden."}):(0,i.jsx)("p",{className:"booking-step-description",children:"Bitte geben Sie Ihre Kontaktdaten an, damit wir Ihren Termin best\xe4tigen k\xf6nnen."}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u()&&r()},className:"booking-form",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"fullName",className:"form-label",children:"Vollst\xe4ndiger Name *"}),(0,i.jsx)("input",{type:"text",id:"fullName",name:"fullName",value:n.fullName,onChange:d,className:"form-input ".concat(o.fullName?"input-error":""),placeholder:"Vor- und Nachname"}),o.fullName&&(0,i.jsx)("span",{className:"error-message",children:o.fullName})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"email",className:"form-label",children:"E-Mail *"}),(0,i.jsx)("input",{type:"email",id:"email",name:"email",value:n.email,onChange:d,className:"form-input ".concat(o.email?"input-error":""),placeholder:"ihre-email@beispiel.de"}),o.email&&(0,i.jsx)("span",{className:"error-message",children:o.email})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"phone",className:"form-label",children:"Telefonnummer *"}),(0,i.jsx)("input",{type:"tel",id:"phone",name:"phone",value:n.phone,onChange:d,className:"form-input ".concat(o.phone?"input-error":""),placeholder:"+49 123 456789"}),o.phone&&(0,i.jsx)("span",{className:"error-message",children:o.phone})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"message",className:"form-label",children:"Nachricht (optional)"}),(0,i.jsx)("textarea",{id:"message",name:"message",value:n.message,onChange:d,className:"form-textarea",placeholder:"Besondere W\xfcnsche oder Anmerkungen",rows:4})]}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"button",onClick:s,className:"btn btn-secondary",children:"Zur\xfcck"}),(0,i.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Weiter"})]})]})]})}t(6880);var c=t(3145),d=t(8114),u=t(3608);let m={start:9,end:18};function g(){let e=[],n=60*m.start,t=60*m.end;for(let s=n;s<t;s+=15){let n=Math.floor(s/60),t=s%60,r="".concat(n.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"));e.push(r)}return e}function h(e){if(!e)return 0;let[n,t]=e.split(":").map(Number);return 60*n+t}async function x(e,n){try{let t=function(e){let n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(n,"-").concat(t,"-").concat(s)}(e);if(console.log("getAvailableTimeSlots f\xfcr Datum:",t),await (0,u.N0)(t))return console.log("❌ Ganzer Tag gesperrt: ".concat(t)),[];let s=await (0,d.c8)(t);console.log("Anzahl Buchungen f\xfcr ".concat(t,":"),s.length);let r=await (0,u.getBlockedTimesForDate)(t);console.log("Anzahl gesperrte Zeiten f\xfcr ".concat(t,":"),r.length),s.forEach((e,n)=>{var t;console.log("Buchung ".concat(n+1,": ").concat(e.time,"-").concat((t=h(e.time)+e.duration,"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0")))))}),r.forEach((e,n)=>{e.isFullDay?console.log("Gesperrt ".concat(n+1,": Ganzer Tag - ").concat(e.reason)):console.log("Gesperrt ".concat(n+1,": ").concat(e.startTime,"-").concat(e.endTime," - ").concat(e.reason))});let i=g();console.log("Pr\xfcfe ".concat(i.length," m\xf6gliche Zeitslots auf Konflikte..."));let a=new Date,l=e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear(),o=60*a.getHours()+a.getMinutes(),c=[];for(let e of i){if(l&&h(e)<=o+30){console.log("Slot ".concat(e," liegt in der Vergangenheit oder ist zu nah an der aktuellen Zeit"));continue}if(await (0,u.isTimeSlotBlocked)(t,e)){console.log("\uD83D\uDEAB Slot ".concat(e," ist vom Admin gesperrt"));continue}!function(e,n,t){if(!n||0===n.length)return!1;console.log("Pr\xfcfe Slot ".concat(e," gegen ").concat(n.length," bestehende Buchungen"));let s=h(e),r=s+t;for(let t of n){if(!t.time||"number"!=typeof t.duration){console.warn("Ung\xfcltige Buchungsdaten:",t);continue}let n=h(t.time),i=n+t.duration;if(s>=n&&s<i||r>n&&r<=i||s<=n&&r>=i)return console.log("Konflikt: Slot ".concat(e," \xfcberschneidet sich mit Buchung um ").concat(t.time," (").concat(t.duration," Min)")),!0}return!1}(e,s,n)?c.push(e):console.log("\uD83D\uDCC5 Slot ".concat(e," ist bereits belegt"))}let x=60*m.end-n,p=c.filter(e=>h(e)<=x);return console.log("✅ Insgesamt ".concat(p.length," verf\xfcgbare Zeitslots gefunden (nach Abzug gesperrter Zeiten)")),p}catch(e){return console.error("Fehler beim Abrufen der verf\xfcgbaren Zeitslots:",e),[]}}g().map(e=>({time:e,duration:120,daysAvailable:[1,2,3,4,5,6]}));let p=[{id:"browlifting",name:"Browlifting",category:"Augenbrauen",description:"Ein Lifting f\xfcr Ihre Augenbrauen, bei dem wir in mehreren Schritten Ihre H\xe4rchen nach oben formen und fixieren. Das Ergebnis sind wundervolle, offene Augen und definierte Augenbrauen f\xfcr bis zu 8 Wochen!",duration:75,price:65,image:"/img/Services/browlifting.jpg"},{id:"browdesign",name:"Brow Design",category:"Augenbrauen",description:"Beim Brow Design werden Ihre Augenbrauen professionell gezupft und in Form gebracht. Wir arbeiten nach den individuellen Gesichtsproportionen f\xfcr ein perfektes und nat\xfcrliches Ergebnis.",duration:30,price:25,image:"/img/Services/browdesign.jpg"},{id:"lashlifting",name:"Lash Lifting",category:"Wimpern",description:"Beim Lash Lifting verwenden wir eine spezielle Technik, um Ihren nat\xfcrlichen Wimpern mehr Schwung und L\xe4nge zu verleihen. Genie\xdfen Sie bis zu 8 Wochen lang wundersch\xf6n geschwungene Wimpern!",duration:60,price:65,image:"/img/Services/lashlifting.jpg"},{id:"lipblush",name:"LipBlush",category:"Lippen",description:"Eine semipermanente Pigmentierung der Lippen, die Ihnen voller aussehende, nat\xfcrlich sch\xf6ne Lippen verleiht. Die Farbe wird individuell auf Ihren Hautton abgestimmt.",duration:120,price:350,image:"/img/Services/lipblush.jpg"},{id:"microblading",name:"Microblading",category:"Augenbrauen",description:"Microblading ist eine semipermanente Pigmentierungstechnik, bei der mit feinen Nadeln haard\xfcnne Striche in die Haut gezeichnet werden. Die Augenbrauen wirken nat\xfcrlich, definiert und ausdrucksstark.",duration:120,price:350,image:"/img/Services/microblading.jpg"},{id:"eyeliner",name:"Eyeliner",category:"Augen",description:"Permanenter Eyeliner f\xfcr einen dauerhaft definierten Blick. Der Farbverlauf wird individuell an Ihre Augenform angepasst und betont auf nat\xfcrliche Weise Ihre Augen.",duration:120,price:350,image:"/img/Services/eyeliner.jpg"},{id:"microneedling",name:"Microneedling",category:"Haut",description:"Microneedling ist ein Verfahren, bei dem kleine Nadeln die Haut oberfl\xe4chlich perforieren, um die Kollagenproduktion anzuregen. Dadurch wird die Hautstruktur verbessert und Falten reduziert.",duration:60,price:149,image:"/img/Services/microneedeling.jpg"}];var f=t(7644);function b(e){let{selectedTreatments:n,toggleTreatment:t,onContinue:s}=e,[r,l]=(0,a.useState)("all"),[o,d]=(0,a.useState)(p),[u,m]=(0,a.useState)({});(0,a.useEffect)(()=>{"all"===r?d(p):d(p.filter(e=>e.category===r))},[r]);let g=e=>n.some(n=>n.id===e);n.reduce((e,n)=>e+n.duration,0);let h=n.reduce((e,n)=>e+n.price,0),x=(0,f.jE)(h),b=e=>{m(n=>({...n,[e]:!n[e]}))},v=n.length>0,j=Array.from(new Set(p.map(e=>e.category)));return(0,i.jsxs)("div",{className:"treatments-container",children:[(0,i.jsx)("h3",{className:"heading-tertiary",children:"Behandlungen"}),(0,i.jsx)("p",{className:"booking-step-description",children:"W\xe4hlen Sie eine oder mehrere Behandlungen aus, die Sie buchen m\xf6chten."}),(0,i.jsxs)("div",{className:"category-tabs",children:[(0,i.jsx)("button",{className:"category-tab ".concat("all"===r?"active":""),onClick:()=>l("all"),children:"Alle"},"all"),j.map(e=>(0,i.jsx)("button",{className:"category-tab ".concat(r===e?"active":""),onClick:()=>l(e),children:e},e))]}),(0,i.jsx)("div",{className:"treatments-grid",children:o.map(e=>{let n=g(e.id),s=e.image,r=(0,f.jE)(e.price),a=u[e.id]||!1;return(0,i.jsxs)("div",{className:"treatment-card ".concat(n?"selected":""),children:[(0,i.jsxs)("div",{className:"treatment-image",onClick:()=>t({id:e.id,name:e.name,duration:e.duration,price:e.price}),children:[(0,i.jsx)(c.default,{src:s,alt:e.name,fill:!0,sizes:"(max-width: 768px) 100vw, 300px",style:{objectFit:"cover"},onError:n=>{n.target.src="https://via.placeholder.com/400x250/b2d8db/333333?text=".concat(encodeURIComponent(e.name))}}),n&&(0,i.jsx)("div",{className:"selected-overlay",children:"✓"})]}),(0,i.jsxs)("div",{className:"treatment-info",onClick:()=>t({id:e.id,name:e.name,duration:e.duration,price:e.price}),children:[(0,i.jsx)("h4",{className:"treatment-name",children:e.name}),(0,i.jsx)("p",{className:"treatment-description",children:e.description}),(0,i.jsxs)("div",{className:"treatment-meta",children:[(0,i.jsxs)("span",{className:"treatment-duration",children:[e.duration," Min."]}),(0,i.jsxs)("div",{className:"treatment-price-container",children:[(0,i.jsx)("span",{className:"treatment-price",children:r.grossFormatted}),(0,i.jsx)("button",{className:"price-details-button",onClick:n=>{n.stopPropagation(),b(e.id)},children:a?"▲":"▼"})]})]}),a&&(0,i.jsxs)("div",{className:"price-breakdown",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"price-row",children:[(0,i.jsx)("span",{children:"Netto:"}),(0,i.jsx)("span",{children:r.netFormatted})]}),(0,i.jsxs)("div",{className:"price-row",children:[(0,i.jsx)("span",{children:"MwSt (19%):"}),(0,i.jsx)("span",{children:r.vatFormatted})]}),(0,i.jsxs)("div",{className:"price-row",children:[(0,i.jsx)("span",{children:"Brutto:"}),(0,i.jsx)("span",{children:r.grossFormatted})]})]})]})]},e.id)})}),n.length>0&&(0,i.jsxs)("div",{className:"treatment-summary",children:[(0,i.jsx)("h4",{className:"summary-title",children:"Ihre Auswahl"}),(0,i.jsx)("div",{className:"summary-items",children:n.map(e=>{let n=(0,f.jE)(e.price);return(0,i.jsxs)("div",{className:"summary-item",children:[(0,i.jsx)("span",{children:e.name}),(0,i.jsx)("span",{children:n.grossFormatted})]},e.id)})}),(0,i.jsxs)("div",{className:"price-breakdown-summary",children:[(0,i.jsxs)("div",{className:"price-row",children:[(0,i.jsx)("span",{children:"Netto-Gesamt:"}),(0,i.jsx)("span",{children:x.netFormatted})]}),(0,i.jsxs)("div",{className:"price-row",children:[(0,i.jsx)("span",{children:"MwSt (19%):"}),(0,i.jsx)("span",{children:x.vatFormatted})]}),(0,i.jsxs)("div",{className:"summary-total",children:[(0,i.jsx)("span",{children:"Brutto-Gesamtpreis:"}),(0,i.jsx)("span",{children:x.grossFormatted})]})]})]}),(0,i.jsx)("div",{className:"form-actions",children:(0,i.jsx)("button",{type:"button",onClick:s,className:"btn btn-primary",disabled:!v,children:"Weiter"})})]})}function v(e){let{selectedTreatments:n,selectedDateTime:s,setSelectedDateTime:r,onBack:l,onContinue:o}=e,[c,m]=(0,a.useState)([]),[p,f]=(0,a.useState)([]),[b,v]=(0,a.useState)([]),[j,N]=(0,a.useState)(new Date),[y,w]=(0,a.useState)(!1),[D,k]=(0,a.useState)(null),[S,B]=(0,a.useState)([]),[T,F]=(0,a.useState)(!1),A=n.reduce((e,n)=>e+n.duration,0),I=async e=>{try{F(!0);let n=new Date(e.getFullYear(),e.getMonth(),1),t=new Date(e.getFullYear(),e.getMonth()+1,0),s=n.toISOString().split("T")[0],r=t.toISOString().split("T")[0];console.log("\uD83D\uDCC5 Lade gesperrte Zeiten f\xfcr ".concat(s," bis ").concat(r));let i=await (0,u.g4)(s,r);B(i),console.log("✅ ".concat(i.length," gesperrte Zeiten geladen f\xfcr ").concat(e.getFullYear(),"-").concat(e.getMonth()+1))}catch(e){console.error("❌ Fehler beim Laden der gesperrten Zeiten:",e),B([])}finally{F(!1)}};(0,a.useEffect)(()=>{let e=[],n=new Date,t=new Date;t.setDate(n.getDate()+1);let s=n.getMonth(),r=new Date(n.getFullYear(),s+3,0),i=new Date(t);for(;i<=r;)e.push(new Date(i)),i.setDate(i.getDate()+1);m(e)},[]),(0,a.useEffect)(()=>{console.log("\uD83D\uDD27 SCHRITT 1: Lade gesperrte Zeiten f\xfcr Kalender-Ansicht..."),I(j)},[j]);let E=e=>{let n=new Date(e);n.setHours(0,0,0,0);let t=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(r)},C=(e,n,t)=>{let s=h(e),r=s+t;return n.some(e=>{if(!e.time||"number"!=typeof e.duration)return console.warn("Ung\xfcltige Buchungsdaten:",e),!1;let n=h(e.time),t=n+e.duration;return s>=n&&s<t||r>n&&r<=t||s<=n&&r>=t})},L=async e=>{if(!e)return v([]),[];console.log("\uD83D\uDD27 SCHRITT 3: Generiere erweiterte Zeitslots mit Verf\xfcgbarkeitsstatus...");try{let n=E(e),s=await (0,d.c8)(n);console.log("\uD83D\uDCC5 ".concat(s.length," Buchungen gefunden f\xfcr ").concat(n));let r=[];try{let{getBlockedTimesForDate:e}=await Promise.resolve().then(t.bind(t,3608));r=await e(n),console.log("\uD83D\uDEAB ".concat(r.length," Admin-Sperrungen gefunden f\xfcr ").concat(n))}catch(e){console.warn("\uD83D\uDD27 FALLBACK: Konnte gesperrte Zeiten nicht laden:",e.message)}let i=g(),a=[];for(let e of i){let n=h(e),t=n+A;if(t>1080)continue;let i=!0,l="";if(s.some(e=>{if(!e.time||"number"!=typeof e.duration)return!1;let s=h(e.time),r=s+e.duration;return n>=s&&n<r||t>s&&t<=r||n<=s&&t>=r})&&(i=!1,l="Bereits gebucht"),i&&r.length>0){let e=r.find(e=>{if(e.isFullDay)return!0;if(!e.startTime||!e.endTime)return!1;let t=h(e.startTime),s=h(e.endTime);return n>=t&&n<s});e&&(i=!1,l=e.isFullDay?"Ganzer Tag gesperrt: ".concat(e.reason):"Gesperrt: ".concat(e.reason))}a.push({time:e,isAvailable:i,reason:l})}let l=a.filter(e=>e.isAvailable).length,o=a.filter(e=>!e.isAvailable).length;return console.log("✅ SCHRITT 3: ".concat(l," verf\xfcgbare + ").concat(o," nicht verf\xfcgbare Zeitslots generiert")),v(a),a.filter(e=>e.isAvailable).map(e=>e.time)}catch(e){return console.error("Fehler beim Generieren der erweiterten Zeitslots:",e),v([]),[]}},M=async e=>{if(!e)return[];w(!0);try{let n=E(e);console.log("DateTimeSelection: Lade Zeitslots f\xfcr ".concat(n)),console.log("\uD83D\uDD27 SCHRITT 2: Verwende getAvailableTimeSlots mit Fallback...");try{let n=await x(e,A);if(0===n.length)throw console.log("⚠️ WARNUNG: getAvailableTimeSlots gab 0 Slots zur\xfcck - verwende Fallback"),Error("Fallback aktiviert");return console.log("✅ SCHRITT 2: ".concat(n.length," verf\xfcgbare Zeitslots gefunden (MIT Admin-Sperrungen)")),await L(e),n}catch(r){console.warn("\uD83D\uDD27 FALLBACK: getAvailableTimeSlots fehlgeschlagen, verwende vereinfachte Version:",r.message);let t=await (0,d.c8)(n);console.log("\uD83D\uDD27 FALLBACK: ".concat(t.length," Buchungen gefunden"));let s=g().filter(e=>{let n=h(e),s=n+A;return!(s>1080)&&!t.some(e=>{if(!e.time||"number"!=typeof e.duration)return!1;let t=h(e.time),r=t+e.duration;return n>=t&&n<r||s>t&&s<=r||n<=t&&s>=r})});return console.log("\uD83D\uDD27 FALLBACK: ".concat(s.length," verf\xfcgbare Zeitslots gefunden (OHNE Admin-Sperrungen)")),await L(e),s}}catch(e){return console.error("Fehler beim Laden der Zeitslots:",e),[]}finally{w(!1)}};(0,a.useEffect)(()=>{(async()=>{if(s.date){if(f([]),k(null),0===s.date.getDay()){k("An Sonntagen sind keine Termine verf\xfcgbar.");return}let e=await M(s.date);f(e),0===e.length&&k("F\xfcr dieses Datum sind keine Zeitslots mit ausreichender Dauer verf\xfcgbar.")}})()},[s.date,A]);let P=async e=>{console.log("Neues Datum ausgew\xe4hlt:",e);let n=new Date(e);n.setHours(0,0,0,0),r(e=>({...e,date:n,time:null})),console.log("\uD83D\uDD27 DEBUG: Laden der gesperrten Zeiten \xfcbersprungen f\xfcr Debugging...")},R=async e=>{if(console.log("Zeit ausgew\xe4hlt:",e,"f\xfcr Datum:",s.date),s.date){let n=E(s.date);console.log("Pr\xfcfe Verf\xfcgbarkeit f\xfcr:",n,e),console.log("\uD83D\uDD27 SCHRITT 2: Pr\xfcfe Admin-Sperrungen bei Zeitauswahl...");try{let{isTimeSlotBlocked:s}=await Promise.resolve().then(t.bind(t,3608));if(await s(n,e)){console.log("\uD83D\uDEAB SCHRITT 2: Zeitslot ".concat(e," ist vom Admin gesperrt")),k("Der gew\xe4hlte Zeitslot ist nicht verf\xfcgbar (administrativ gesperrt). Bitte w\xe4hlen Sie eine andere Zeit.");return}console.log("✅ SCHRITT 2: Zeitslot ".concat(e," ist NICHT gesperrt"))}catch(e){console.warn("\uD83D\uDD27 FALLBACK: Admin-Sperrung-Pr\xfcfung fehlgeschlagen, erlaube Zeitslot:",e.message)}if(C(e,await (0,d.c8)(n),A)){let n=await M(s.date),t=n.findIndex(n=>h(n)>h(e)),r=-1!==t?n[t]:null;r?k("Der gew\xe4hlte Zeitslot ist bereits belegt. Der n\xe4chste verf\xfcgbare Termin ist um ".concat(r," Uhr.")):k("Der gew\xe4hlte Zeitslot ist bereits belegt. Es gibt keine weiteren verf\xfcgbaren Zeitslots f\xfcr diesen Tag.");return}let i={date:s.date,time:e};console.log("Setze neuen Termin:",i),r(i),k(null)}else console.error("Kein Datum ausgew\xe4hlt, kann Zeit nicht setzen"),k("Bitte w\xe4hlen Sie zuerst ein Datum aus.")},z=(()=>{let e=j.getFullYear(),n=j.getMonth(),t=new Date(e,n,1).getDay()-1;-1===t&&(t=6);let r=new Date(e,n+1,0).getDate(),i=[];for(let e=0;e<t;e++)i.push({day:null,date:null});let a=new Date;a.setHours(0,0,0,0);for(let t=1;t<=r;t++){let r=new Date(e,n,t),l=0===r.getDay(),o=r.toISOString().split("T")[0],c=S.find(e=>e.date===o&&!0===e.isFullDay),d=!!c;d&&console.log("\uD83D\uDD27 SCHRITT 1: Tag ".concat(o," ist vollst\xe4ndig gesperrt:"),null==c?void 0:c.reason);let u=r<a,m=!l&&!u&&!d,g=s.date&&r.getDate()===s.date.getDate()&&r.getMonth()===s.date.getMonth()&&r.getFullYear()===s.date.getFullYear();i.push({day:t,date:r,isAvailable:m,isPast:u,isSelected:g,isSunday:l,isBlockedByAdmin:d,blockedReason:(null==c?void 0:c.reason)||null})}return i})(),Z=null!==s.date&&null!==s.time,W="".concat(["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][j.getMonth()]," ").concat(j.getFullYear());return(0,i.jsxs)("div",{className:"datetime-selection-container",children:[(0,i.jsx)("h3",{className:"heading-tertiary",children:"Termindaten"}),(0,i.jsxs)("p",{className:"booking-step-description",children:["Bitte w\xe4hlen Sie ein Datum und eine Uhrzeit f\xfcr Ihre Behandlung.",A>0&&(0,i.jsxs)("span",{className:"total-duration",children:[" ","Gesamtdauer: ",A," Minuten"]})]}),(0,i.jsxs)("div",{className:"calendar-container",children:[(0,i.jsxs)("div",{className:"calendar-header",children:[(0,i.jsx)("button",{type:"button",onClick:()=>{let e=new Date(j);e.setMonth(e.getMonth()-1);let n=new Date;e.getFullYear()<n.getFullYear()||e.getFullYear()===n.getFullYear()&&e.getMonth()<n.getMonth()||N(e)},className:"month-nav-btn","aria-label":"Vorheriger Monat",children:"<"}),(0,i.jsx)("h4",{className:"current-month",children:W}),(0,i.jsx)("button",{type:"button",onClick:()=>{let e=new Date(j);e.setMonth(e.getMonth()+1),N(e)},className:"month-nav-btn","aria-label":"N\xe4chster Monat",children:">"})]}),(0,i.jsxs)("div",{className:"calendar-weekdays",children:[(0,i.jsx)("div",{className:"weekday",children:"Mo"}),(0,i.jsx)("div",{className:"weekday",children:"Di"}),(0,i.jsx)("div",{className:"weekday",children:"Mi"}),(0,i.jsx)("div",{className:"weekday",children:"Do"}),(0,i.jsx)("div",{className:"weekday",children:"Fr"}),(0,i.jsx)("div",{className:"weekday",children:"Sa"}),(0,i.jsx)("div",{className:"weekday",children:"So"})]}),(0,i.jsx)("div",{className:"calendar-days",children:z.map((e,n)=>(0,i.jsxs)("div",{className:"calendar-day ".concat(e.day?"":"empty-day"," ").concat(e.isSunday?"sunday":""," ").concat(e.isPast?"past-day":""," ").concat(e.isBlockedByAdmin?"blocked-day":""," ").concat(e.isAvailable?"available-day":""," ").concat(e.isSelected?"selected-day":""),onClick:()=>{e.day&&e.isAvailable&&P(e.date)},title:e.isBlockedByAdmin?"\uD83D\uDEAB Nicht verf\xfcgbar: ".concat(e.blockedReason):e.isSunday?"❌ Sonntags geschlossen":e.isPast?"❌ Datum liegt in der Vergangenheit":"",children:[e.day,e.isBlockedByAdmin&&(0,i.jsxs)("div",{className:"blocked-tooltip",children:[(0,i.jsx)("strong",{children:"\uD83D\uDEAB Nicht verf\xfcgbar"}),(0,i.jsx)("br",{}),e.blockedReason]})]},n))}),(0,i.jsxs)("div",{className:"calendar-legend",children:[(0,i.jsxs)("div",{className:"legend-item",children:[(0,i.jsx)("div",{className:"legend-indicator available"}),(0,i.jsx)("span",{children:"Verf\xfcgbar"})]}),(0,i.jsxs)("div",{className:"legend-item",children:[(0,i.jsx)("div",{className:"legend-indicator sunday"}),(0,i.jsx)("span",{children:"Sonntags geschlossen"})]}),(0,i.jsxs)("div",{className:"legend-item",children:[(0,i.jsx)("div",{className:"legend-indicator past"}),(0,i.jsx)("span",{children:"Vergangen"})]}),(0,i.jsxs)("div",{className:"legend-item",children:[(0,i.jsx)("div",{className:"legend-indicator blocked"}),(0,i.jsx)("span",{children:"Gesperrt"})]}),T&&(0,i.jsx)("div",{className:"legend-loading",children:(0,i.jsx)("span",{children:"⏳ Lade Sperrungen..."})})]})]}),s.date&&(0,i.jsxs)("div",{className:"time-slots-container",children:[(0,i.jsx)("h4",{className:"time-slots-heading",children:"Verf\xfcgbare Zeiten"}),y?(0,i.jsx)("p",{className:"loading-message",children:"Lade verf\xfcgbare Zeiten..."}):(0,i.jsxs)(i.Fragment,{children:[D&&(0,i.jsx)("p",{className:"unavailable-message",children:D}),(0,i.jsx)("div",{className:"time-slots-grid",children:b.length>0?b.map((e,n)=>(0,i.jsxs)("button",{type:"button",className:"time-slot ".concat(s.time===e.time?"selected-time":""," ").concat(e.isAvailable?"":"unavailable-time"),onClick:()=>e.isAvailable&&R(e.time),disabled:!e.isAvailable,title:e.isAvailable?"Verf\xfcgbar um ".concat(e.time):"Nicht verf\xfcgbar: ".concat(e.reason),children:[e.time,!e.isAvailable&&(0,i.jsx)("span",{className:"unavailable-icon",children:"\uD83D\uDEAB"})]},n)):!D&&(0,i.jsx)("p",{className:"no-slots-message",children:"Keine Zeiten f\xfcr dieses Datum verf\xfcgbar."})}),b.length>0&&(0,i.jsxs)("div",{className:"time-slots-legend",children:[(0,i.jsxs)("div",{className:"legend-item",children:[(0,i.jsx)("div",{className:"legend-indicator time-available"}),(0,i.jsx)("span",{children:"Verf\xfcgbar"})]}),(0,i.jsxs)("div",{className:"legend-item",children:[(0,i.jsx)("div",{className:"legend-indicator time-unavailable",children:(0,i.jsx)("span",{className:"mini-icon",children:"\uD83D\uDEAB"})}),(0,i.jsx)("span",{children:"Nicht verf\xfcgbar"})]})]})]})]}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"button",onClick:l,className:"btn btn-secondary",children:"Zur\xfcck"}),(0,i.jsx)("button",{type:"button",onClick:()=>{if(!s.date||!s.time){k("Bitte w\xe4hlen Sie ein Datum und eine Uhrzeit aus, bevor Sie fortfahren.");return}console.log("DateTimeSelection - Fortfahren mit:",s),o()},className:"btn btn-primary",disabled:!Z,children:"Weiter"})]})]})}t(5587);var j=t(6108),N=t(3301);let y=(0,a.createContext)({user:null,loading:!0,customerData:null}),w=()=>(0,a.useContext)(y);var D=t(1405);function k(e){let{totalPrice:n,onDiscountCalculated:t,showProgress:s=!0,currentTreatments:r=[]}=e,[l,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=(0,N.Aj)(j.I8,e=>{m(e),e?g(e.uid):(o(null),d(!1))});return()=>e()},[n,r]);let g=async e=>{try{d(!0);let s=await h(e,n,r);o(s),null==t||t(s)}catch(e){console.error("Fehler bei Rabattberechnung:",e),o({type:"none",percentage:0,amount:0,description:"Rabattberechnung nicht verf\xfcgbar",isEligible:!1})}finally{d(!1)}},h=async(e,n,t)=>{try{console.log("\uD83D\uDD0D DiscountDisplay: Pr\xfcfe Rabatt-Berechtigung f\xfcr User:",e);let s=await (0,D.yX)(e,n),r=await (0,D.Gf)(e),i=t.length;if(s.description.includes("bereits verwendet"))return console.log("❌ Rabatt bereits in dieser Session verwendet, starte neue Z\xe4hlung:",{bisherigeNachReset:r.progress.current,aktuelleAuswahl:i,neueZählung:i}),{type:"none",percentage:0,amount:0,description:"Treuerabatt bereits in dieser Session verwendet. Laden Sie die Seite neu f\xfcr weitere Buchungen.",isEligible:!1,progressInfo:{current:i,required:5,remaining:Math.max(0,5-i)}};let a=r.progress.current,l=a+i;if(console.log("\uD83C\uDFAF KORRIGIERTE Behandlungsberechnung:",{bisherigeNachLetztemRabatt:a,aktuelleAuswahl:i,korrekteGesamtzahl:l,benötigtFürRabatt:5,würdeBerechtigen:l>=5}),l>=5){let e=.2*n;return console.log("✅ TREUERABATT GEW\xc4HRT!",{finalAmount:e,originalPrice:n,totalTreatments:l}),{type:"loyalty",percentage:20,amount:e,description:"\uD83C\uDF89 Treuerabatt erreicht! Sie erhalten 20% Rabatt auf diese Buchung!",isEligible:!0,progressInfo:{current:l,required:5,remaining:Math.max(0,5-l)}}}if(r.isEligible){let e=.2*n;return{type:"loyalty",percentage:20,amount:e,description:"Treuerabatt - Sie sind berechtigt f\xfcr 20% Rabatt!",isEligible:!0,progressInfo:r.progress}}if((await (0,D.h1)(e)).isEligible){let e=.1*n;return{type:"birthday",percentage:10,amount:e,description:"Geburtstagsrabatt - Alles Gute zum Geburtstag! \uD83C\uDF89",isEligible:!0}}let o=Math.max(0,5-l);return{type:"none",percentage:0,amount:0,description:"Noch ".concat(o," Behandlungen bis zum Treuerabatt"),isEligible:!1,progressInfo:{current:l,required:5,remaining:o}}}catch(e){return console.error("Fehler bei der Rabattberechnung:",e),{type:"none",percentage:0,amount:0,description:"Rabattberechnung nicht verf\xfcgbar",isEligible:!1}}};if(!u)return(0,i.jsx)("div",{className:"discount-guest-info",children:(0,i.jsxs)("div",{className:"discount-card discount-info",children:[(0,i.jsx)("div",{className:"discount-icon",children:(0,i.jsx)("ion-icon",{name:"person-outline"})}),(0,i.jsxs)("div",{className:"discount-content",children:[(0,i.jsx)("h4",{children:"Exklusive Rabatte f\xfcr Mitglieder"}),(0,i.jsx)("p",{children:"Melden Sie sich an, um von Treue- und Geburtstagsrabatten zu profitieren!"})]})]})});if(c)return(0,i.jsx)("div",{className:"discount-loading",children:(0,i.jsxs)("div",{className:"discount-card",children:[(0,i.jsx)("div",{className:"discount-spinner"}),(0,i.jsx)("p",{children:"Rabatte werden berechnet..."})]})});if(!l)return null;let x=n-l.amount;return(0,i.jsx)("div",{className:"discount-display",children:l.isEligible?(0,i.jsxs)("div",{className:"discount-card discount-active",children:[(0,i.jsxs)("div",{className:"discount-header",children:[(0,i.jsx)("div",{className:"discount-icon discount-icon-active",children:"loyalty"===l.type?(0,i.jsx)("ion-icon",{name:"star"}):(0,i.jsx)("ion-icon",{name:"gift"})}),(0,i.jsxs)("div",{className:"discount-badge",children:["-",l.percentage,"%"]})]}),(0,i.jsxs)("div",{className:"discount-content",children:[(0,i.jsx)("h4",{className:"discount-title",children:"loyalty"===l.type?"\uD83C\uDF89 Treuerabatt":"\uD83C\uDF82 Geburtstagsrabatt"}),(0,i.jsx)("p",{className:"discount-description",children:l.description}),(0,i.jsxs)("div",{className:"discount-calculation",children:[(0,i.jsxs)("div",{className:"price-row original-price",children:[(0,i.jsx)("span",{children:"Originalpreis:"}),(0,i.jsxs)("span",{children:["€",n.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"price-row discount-amount",children:[(0,i.jsxs)("span",{children:["Rabatt (",l.percentage,"%):"]}),(0,i.jsxs)("span",{children:["-€",l.amount.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"price-row final-price",children:[(0,i.jsx)("span",{children:"Endpreis:"}),(0,i.jsxs)("span",{children:["€",x.toFixed(2)]})]})]}),(0,i.jsxs)("div",{className:"discount-savings",children:["Sie sparen €",l.amount.toFixed(2),"!"]})]})]}):s&&l.progressInfo&&(0,i.jsxs)("div",{className:"discount-card discount-progress",children:[(0,i.jsx)("div",{className:"discount-icon",children:(0,i.jsx)("ion-icon",{name:"star-outline"})}),(0,i.jsxs)("div",{className:"discount-content",children:[(0,i.jsx)("h4",{className:"discount-title",children:"Treuerabatt-Fortschritt"}),(0,i.jsx)("p",{className:"discount-description",children:l.description}),(0,i.jsxs)("div",{className:"progress-container",children:[(0,i.jsx)("div",{className:"progress-bar",children:(0,i.jsx)("div",{className:"progress-fill",style:{width:"".concat(l.progressInfo.current/l.progressInfo.required*100,"%")}})}),(0,i.jsxs)("div",{className:"progress-text",children:[l.progressInfo.current," /"," ",l.progressInfo.required," Behandlungen"]})]}),(0,i.jsxs)("div",{className:"progress-motivation",children:["Noch ",l.progressInfo.remaining," Behandlungen bis zu 20% Rabatt!"]})]})]})})}let S=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e);function B(e){let{selectedTreatments:n,selectedDateTime:t,customerInfo:s,onBack:r,onConfirm:l,error:o}=e,[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[g,h]=(0,a.useState)(null),[x,p]=(0,a.useState)(0),{user:f}=w(),b=n.reduce((e,n)=>e+n.price,0),v=n.reduce((e,n)=>e+n.duration,0);return(0,a.useEffect)(()=>{g||p(b)},[b,g]),(0,a.useEffect)(()=>{console.log("BookingSummary Debug:"),console.log("- selectedTreatments:",n),console.log("- selectedDateTime:",JSON.stringify(t,null,2)),console.log("- customerInfo:",JSON.stringify(s,null,2)),console.log("- selectedDateTime.date:",null==t?void 0:t.date),console.log("- selectedDateTime.time:",null==t?void 0:t.time),console.log("- customerInfo.firstName:",null==s?void 0:s.firstName),console.log("- customerInfo.lastName:",null==s?void 0:s.lastName),console.log("- customerInfo.email:",null==s?void 0:s.email),g&&(console.log("- Rabattinfo:",g),console.log("- Originalpreis:",b),console.log("- Endpreis:",x),console.log("- Ersparnis:",g.amount))},[n,b,f,s,g,x]),(0,i.jsxs)("div",{className:"booking-summary bg-white rounded-lg shadow-md border border-gray-100",children:[(0,i.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,i.jsx)("h3",{className:"text-2xl font-semibold text-gray-800",children:"Buchungs\xfcbersicht"})}),n.length>0?(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"grid gap-8",children:[(0,i.jsxs)("div",{className:"booking-section",children:[(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"}),(0,i.jsx)("line",{x1:"16",y1:"8",x2:"2",y2:"22"}),(0,i.jsx)("line",{x1:"17.5",y1:"15",x2:"9",y2:"15"})]}),"Ausgew\xe4hlte Behandlungen"]}),(0,i.jsx)("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,i.jsx)("ul",{className:"divide-y divide-gray-200",children:n.map(e=>(0,i.jsxs)("li",{className:"py-4 flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("span",{className:"text-lg font-medium text-gray-800",children:e.name}),(0,i.jsxs)("span",{className:"text-base text-gray-500 flex items-center gap-1 mt-1",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),e.duration," Min."]})]}),(0,i.jsx)("span",{className:"text-lg font-semibold text-gray-800",children:S(e.price)})]},e.id))})})]}),t&&(0,i.jsxs)("div",{className:"booking-section",children:[(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,i.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,i.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,i.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Termin"]}),(0,i.jsx)("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,i.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,i.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,i.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-base text-gray-500",children:"Datum"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:(e=>{if(!e)return"Kein Datum gew\xe4hlt";try{let n;if(n=e instanceof Date?e:new Date(e),isNaN(n.getTime()))return"Ung\xfcltiges Datum";return n.toLocaleDateString("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch(e){return console.error("Fehler beim Formatieren des Datums:",e),"Ung\xfcltiges Datum"}})(t.date)||"Kein Datum gew\xe4hlt"})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-base text-gray-500",children:"Uhrzeit"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:t.time&&""!==t.time?"".concat(t.time," Uhr"):"Keine Uhrzeit gew\xe4hlt"})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-base text-gray-500",children:"Gesamtdauer"}),(0,i.jsxs)("p",{className:"text-lg font-medium text-gray-800",children:[v," Minuten"]})]})]})]})})]}),s&&(0,i.jsxs)("div",{className:"booking-section",children:[(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"12",cy:"7",r:"4"})]}),"Ihre Daten"]}),(0,i.jsx)("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-base text-gray-500",children:"Name"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:(()=>{if(!s)return"Kein Kunde angegeben";if(s.firstName&&s.lastName){let e=s.firstName.trim(),n=s.lastName.trim();return"".concat(e," ").concat(n)}if(s.firstName||s.lastName)return(s.firstName||s.lastName||"").trim();if("fullName"in s&&s.fullName){let e=s.fullName.trim();return""!==e?e:"Kein Name angegeben"}if("name"in s&&s.name){let e=s.name.trim();return""!==e?e:"Kein Name angegeben"}return s.email&&s.email.includes("@")?s.email.split("@")[0]:"Kein Name angegeben"})()||"Kein Name angegeben"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-base text-gray-500",children:"E-Mail"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:s.email&&""!==s.email.trim()?s.email:"Keine E-Mail angegeben"})]}),(s.phone||"phoneNumber"in s&&s.phoneNumber)&&(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-base text-gray-500",children:"Telefon"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:s.phone||("phoneNumber"in s?s.phoneNumber:"Keine Telefonnummer")})]})]})})]}),(0,i.jsx)(k,{totalPrice:b,onDiscountCalculated:e=>{h(e),p(b-e.amount)},showProgress:!0,currentTreatments:n}),(0,i.jsxs)("div",{className:"booking-section",children:[(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,i.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Preis\xfcbersicht"]}),(0,i.jsx)("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,i.jsxs)("div",{className:"divide-y divide-gray-200",children:[(0,i.jsxs)("div",{className:"price-row py-3 flex justify-between text-lg",children:[(0,i.jsx)("span",{children:"Grundpreis:"}),(0,i.jsx)("span",{className:"font-medium",children:S(b)})]}),g&&g.isEligible&&(0,i.jsxs)("div",{className:"price-row py-3 flex justify-between text-lg text-green-600",children:[(0,i.jsxs)("span",{children:["loyalty"===g.type?"Treuerabatt":"Geburtstagsrabatt","(",g.percentage,"%):"]}),(0,i.jsxs)("span",{className:"font-medium",children:["-",S(g.amount)]})]}),(0,i.jsxs)("div",{className:"total-price-row py-4 flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-semibold text-xl",children:"Gesamt:"}),(0,i.jsx)("span",{className:"font-bold text-2xl text-[#28a745]",children:S(x)})]}),g&&g.isEligible&&g.amount>0&&(0,i.jsx)("div",{className:"savings-highlight py-3",children:(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M20 12v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6"}),(0,i.jsx)("polyline",{points:"9 17 12 14 15 17"}),(0,i.jsx)("polyline",{points:"15 7 12 10 9 7"})]}),(0,i.jsxs)("span",{className:"font-semibold",children:["Sie sparen ",S(g.amount),"!"]})]})})}),(0,i.jsxs)("div",{className:"price-details py-4",children:[(0,i.jsxs)("p",{className:"text-base text-gray-500",children:["Enthaltene MwSt (19%):"," ",S(.19*x/1.19)]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-base text-gray-500",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),(0,i.jsxs)("span",{children:["Gesamtdauer: ",v," Min."]})]})]})]})})]}),(0,i.jsxs)("div",{className:"booking-actions mt-6 flex flex-col sm:flex-row gap-4",children:[(0,i.jsx)("button",{type:"button",onClick:r,className:"py-4 px-6 text-lg rounded-md border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 transition-colors flex-1",children:"Zur\xfcck"}),(0,i.jsx)("button",{type:"button",onClick:()=>{let e={treatments:n,dateTime:t,customer:s,discountInfo:g,originalPrice:b,finalPrice:x,appliedDiscount:(null==g?void 0:g.isEligible)?g:null};try{sessionStorage.setItem("bookingTreatments",JSON.stringify(n)),sessionStorage.setItem("bookingDataWithDiscount",JSON.stringify(e)),(null==g?void 0:g.isEligible)&&(sessionStorage.setItem("appliedDiscount",JSON.stringify(g)),sessionStorage.setItem("originalPrice",b.toString()),sessionStorage.setItem("finalPrice",x.toString())),window.__BOOKING_TREATMENTS__=n,window.__BOOKING_DISCOUNT_DATA__=e,localStorage.setItem("bookingTreatments",JSON.stringify(n)),localStorage.setItem("bookingDataWithDiscount",JSON.stringify(e)),console.log("\uD83D\uDCBE Buchungsdaten mit Rabatt gespeichert:",{treatments:n.length,originalPrice:b,finalPrice:x,discount:(null==g?void 0:g.isEligible)?"".concat(g.percentage,"%"):"Kein Rabatt",savings:(null==g?void 0:g.amount)||0})}catch(e){console.error("Fehler beim Speichern der Buchungsdaten:",e)}console.log("✅ Best\xe4tigung mit kompletten Buchungsdaten:",e);try{l(n)}catch(e){l()}},className:"py-4 px-6 text-lg rounded-md bg-[#b2d8db] text-gray-800 font-medium hover:bg-[#9ecacd] transition-colors flex-1",children:"Termin verbindlich buchen"})]})]})}):(0,i.jsxs)("div",{className:"p-10 text-center",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 mx-auto text-gray-300 mb-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,i.jsx)("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),(0,i.jsx)("p",{className:"text-xl text-gray-500 mb-6",children:"Sie haben noch keine Behandlungen ausgew\xe4hlt."}),(0,i.jsx)("button",{onClick:r,className:"py-4 px-8 text-lg rounded-md bg-[#b2d8db] text-gray-800 font-medium hover:bg-[#9ecacd] transition-colors",children:"Zur\xfcck zur Behandlungsauswahl"})]}),o&&(0,i.jsx)("div",{className:"p-5 bg-red-50 text-red-600 border-t border-red-200 rounded-b-lg text-lg",children:o})]})}var T=t(9376);function F(e){var n,t,s;let{selectedTreatments:r,selectedDateTime:o,customerInfo:c}=e,d=(0,T.useRouter)(),[u,m]=(0,a.useState)(null),[g,h]=(0,a.useState)(0),[x,p]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e=r.reduce((e,n)=>e+n.price,0);p(e),h(e);try{let n=sessionStorage.getItem("bookingDataWithDiscount"),t=sessionStorage.getItem("finalPrice"),s=sessionStorage.getItem("appliedDiscount");if(n){let t=JSON.parse(n);m(t),h(t.finalPrice||e),console.log("\uD83C\uDFAF Rabattdaten in Best\xe4tigung geladen:",{original:e,final:t.finalPrice,discount:t.appliedDiscount})}else if(t){let e=parseFloat(t);if(h(e),s){let e=JSON.parse(s);m({appliedDiscount:e})}}}catch(e){console.error("Fehler beim Laden der Rabattdaten in Best\xe4tigung:",e)}},[r]),console.log("BookingConfirmation geladen - ID:",(null===(n=r[0])||void 0===n?void 0:n.id)||"N/A");let b=r.reduce((e,n)=>e+n.duration,0),v=r.map(e=>{let n=(0,f.jE)(e.price);return{...e,priceComponents:n}}),j=(0,f.jE)(g);(0,f.jE)(x);let N=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),y="SHN-".concat(Math.floor(1e4*Math.random()),"-").concat(new Date().getFullYear());return(0,i.jsxs)("div",{className:"max-w-4xl mx-auto bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden",children:[(0,i.jsxs)("div",{className:"bg-[#e8f3f4] p-8 text-center",children:[(0,i.jsx)("div",{className:"mx-auto w-16 h-16 bg-[#b2d8db] rounded-full flex items-center justify-center mb-4 shadow-md",children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,i.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Buchung erfolgreich!"}),(0,i.jsxs)("p",{className:"text-lg text-gray-600",children:["Vielen Dank f\xfcr Ihre Buchung, ",c.fullName,"! Eine Best\xe4tigungsmail wurde an"," ",(0,i.jsx)("span",{className:"font-medium",children:c.email})," gesendet."]})]}),(0,i.jsxs)("div",{className:"p-6 md:p-8",children:[(0,i.jsxs)("div",{className:"mb-8 flex justify-between items-center",children:[(0,i.jsx)("h3",{className:"text-2xl font-semibold text-gray-800",children:"Ihre Buchungsdetails"}),(0,i.jsx)("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:(0,i.jsxs)("p",{className:"text-base font-medium",children:["Buchungsnummer:"," ",(0,i.jsx)("span",{className:"text-[#28a745] font-bold",children:y})]})})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,i.jsx)("div",{className:"md:col-span-2",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,i.jsx)("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"}),(0,i.jsx)("line",{x1:"16",y1:"8",x2:"2",y2:"22"}),(0,i.jsx)("line",{x1:"17.5",y1:"15",x2:"9",y2:"15"})]}),"Gebuchte Behandlungen"]})}),(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)("ul",{className:"divide-y divide-gray-200",children:v.map(e=>(0,i.jsx)("li",{className:"py-4 first:pt-2 last:pb-2",children:(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("span",{className:"text-lg font-medium text-gray-800",children:e.name}),(0,i.jsx)("span",{className:"text-lg font-semibold text-gray-800",children:(0,f.T4)(e.price)})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1 text-gray-500",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),(0,i.jsxs)("span",{children:[e.duration," Min."]})]})]})},e.id))})})]})}),(0,i.jsx)("div",{className:"md:col-span-1",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden h-full",children:[(0,i.jsx)("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,i.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,i.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,i.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Termin"]})}),(0,i.jsx)("div",{className:"p-4",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Datum"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:(e=>{if(!e)return"Kein Datum gew\xe4hlt";try{let n;if(n=e instanceof Date?e:new Date(e),isNaN(n.getTime()))return"Ung\xfcltiges Datum";return new Intl.DateTimeFormat("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(n)}catch(e){return console.error("Fehler beim Formatieren des Datums:",e),"Ung\xfcltiges Datum"}})(o.date)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Uhrzeit"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:o.time?o.time+" Uhr":"Keine Uhrzeit gew\xe4hlt"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Gesamtdauer"}),(0,i.jsxs)("p",{className:"text-lg font-medium text-gray-800",children:[b," Minuten"]})]})]})})]})})]}),(0,i.jsx)("div",{className:"mb-8",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,i.jsx)("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"12",cy:"7",r:"4"})]}),"Ihre Daten"]})}),(0,i.jsx)("div",{className:"p-4",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Name"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:c.fullName||"Kein Name angegeben"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"E-Mail"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:c.email||"Keine E-Mail angegeben"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Telefon"}),(0,i.jsx)("p",{className:"text-lg font-medium text-gray-800",children:c.phone||"Keine Telefonnummer angegeben"})]}),c.message&&(0,i.jsxs)("div",{className:"col-span-full mt-2",children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Ihre Nachricht"}),(0,i.jsx)("p",{className:"text-base",children:c.message})]})]})})]})}),(0,i.jsx)("div",{className:"mb-8",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,i.jsx)("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,i.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),(0,i.jsx)("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Preis\xfcbersicht"]})}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsxs)("div",{className:"divide-y divide-gray-200",children:[(0,i.jsxs)("div",{className:"py-3 flex justify-between text-lg",children:[(0,i.jsx)("span",{children:"Grundpreis:"}),(0,i.jsx)("span",{className:"font-medium",children:N(x)})]}),(null==u?void 0:null===(t=u.appliedDiscount)||void 0===t?void 0:t.isEligible)&&(0,i.jsxs)("div",{className:"py-3 flex justify-between text-lg text-green-600",children:[(0,i.jsxs)("span",{children:["loyalty"===u.appliedDiscount.type?"Treuerabatt":"Geburtstagsrabatt","(",u.appliedDiscount.percentage,"%):"]}),(0,i.jsxs)("span",{className:"font-medium",children:["-",N(u.appliedDiscount.amount)]})]}),(0,i.jsxs)("div",{className:"py-4 flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-semibold text-xl",children:"Gesamt:"}),(0,i.jsx)("span",{className:"font-bold text-2xl text-[#28a745]",children:N(g)})]}),(null==u?void 0:null===(s=u.appliedDiscount)||void 0===s?void 0:s.isEligible)&&u.appliedDiscount.amount>0&&(0,i.jsx)("div",{className:"py-3",children:(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M20 12v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6"}),(0,i.jsx)("polyline",{points:"9 17 12 14 15 17"}),(0,i.jsx)("polyline",{points:"15 7 12 10 9 7"})]}),(0,i.jsxs)("span",{className:"font-semibold",children:["Sie haben"," ",N(u.appliedDiscount.amount)," ","gespart!"]})]})})})]}),(0,i.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,i.jsxs)("p",{className:"flex justify-between text-base text-gray-600",children:[(0,i.jsx)("span",{children:"Netto-Gesamt:"}),(0,i.jsx)("span",{children:j.netFormatted})]}),(0,i.jsxs)("p",{className:"flex justify-between text-base text-gray-600 mt-2",children:[(0,i.jsx)("span",{children:"MwSt (19%):"}),(0,i.jsx)("span",{children:j.vatFormatted})]}),(0,i.jsxs)("div",{className:"pt-3 mt-3 border-t border-gray-200 flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-semibold text-xl",children:"Gesamtbetrag:"}),(0,i.jsx)("span",{className:"font-bold text-2xl text-[#28a745]",children:j.grossFormatted})]})]})]})]})}),(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mt-6",children:[(0,i.jsx)(l.default,{href:"/",className:"py-4 px-6 rounded-md bg-white border border-gray-300 text-gray-700 text-lg font-medium hover:bg-gray-50 transition-colors text-center flex-1",children:"Zur\xfcck zur Startseite"}),(0,i.jsx)("button",{onClick:()=>{console.log("\uD83D\uDD04 Starte neue Buchung...");try{localStorage.removeItem("bookingTreatments"),sessionStorage.removeItem("bookingTreatments"),sessionStorage.removeItem("bookingDataWithDiscount"),sessionStorage.removeItem("appliedDiscount"),sessionStorage.removeItem("originalPrice"),sessionStorage.removeItem("finalPrice"),localStorage.removeItem("bookingDataWithDiscount"),window.__BOOKING_TREATMENTS__=null,window.__BOOKING_DISCOUNT_DATA__=null,console.log("✅ Buchungsdaten gel\xf6scht")}catch(e){console.error("❌ Fehler beim L\xf6schen der Buchungsdaten:",e)}let e="/booking?step=treatments&refresh="+Date.now();console.log("\uD83D\uDE80 Navigiere zu:",e);try{d.push(e),console.log("✅ Router.push ausgef\xfchrt"),setTimeout(()=>{console.log("\uD83D\uDD04 Fallback: Verwende window.location"),window.location.href=e},100)}catch(n){console.error("❌ Router.push fehlgeschlagen, verwende window.location:",n),window.location.href=e}},className:"py-4 px-6 rounded-md bg-[#b2d8db] text-gray-800 text-lg font-medium hover:bg-[#9ecacd] transition-colors text-center flex-1",children:"Weitere Behandlung buchen"})]})]})]})}let A={pmu:"\n    <h4>Permanent Make-up – PMU (Augenbrauen, Lippen, Eyeliner)</h4>\n    <p><strong>Nicht geeignet f\xfcr:</strong></p>\n    <ul>\n      <li>Schwangere oder stillende Personen</li>\n      <li>Personen mit aktiven Hautkrankheiten im Behandlungsbereich</li>\n      <li>Personen mit Blutgerinnungsst\xf6rungen oder Einnahme blutverd\xfcnnender Medikamente</li>\n    </ul>\n    <p><strong>24 Stunden vor der Behandlung:</strong></p>\n    <ul>\n      <li>Kein Kaffee, Alkohol oder blutverd\xfcnnende Medikamente (z. B. Aspirin) einnehmen.</li>\n    </ul>\n    <p><strong>7 Tage vor der Behandlung:</strong></p>\n    <ul>\n      <li>Keine Botox- oder Filler-Behandlungen im Behandlungsbereich.</li>\n    </ul>\n    <p><strong>Bei Lippen-PMU:</strong></p>\n    <ul>\n      <li>Falls Sie zu Herpes neigen, empfehlen wir eine Prophylaxe vor der Behandlung.</li>\n      <li>Falls Ihre Lippen trocken sind, f\xfchren Sie bitte 1–2 Tage vor der Behandlung ein sanftes Peeling durch und verwenden Sie eine feuchtigkeitsspendende Lippenpflege.</li>\n    </ul>\n    <p><strong>Wichtiger Hinweis:</strong></p>\n    <ul>\n      <li>Die behandelte Stelle darf f\xfcr 48 Stunden nicht mit Wasser in Kontakt kommen. Bitte planen Sie Ihre Haarw\xe4sche oder Dusche entsprechend im Voraus.</li>\n    </ul>\n  ","lash-lifting":"\n    <h4>Lash Lifting – Wimpernlifting</h4>\n    <ul>\n      <li>Bitte kommen Sie ungeschminkt zur Behandlung.</li>\n      <li>Hormonelle Schwankungen (z. B. Periode, Schwangerschaft, Stillzeit) k\xf6nnen das Ergebnis beeinflussen.</li>\n      <li>Verwenden Sie 24 Stunden vor der Behandlung keine \xf6lhaltigen Produkte auf den Wimpern.</li>\n      <li>Falls Sie empfindliche Augen oder Allergien haben, teilen Sie uns dies bitte im Voraus mit.</li>\n      <li>Tragen Sie keine Kontaktlinsen w\xe4hrend der Behandlung. Bitte entfernen Sie Ihre Linsen vorher oder bringen Sie Ihr Etui und Pflegemittel mit.</li>\n    </ul>\n  ",browlifting:"\n    <h4>Brow Lifting – Augenbrauenlifting</h4>\n    <ul>\n      <li>Bitte kommen Sie ohne Make-up an den Augenbrauen.</li>\n      <li>Die Haut sollte frei von Irritationen, Wunden oder Sonnenbrand sein.</li>\n      <li>Hormonelle Ver\xe4nderungen k\xf6nnen das Ergebnis beeinflussen.</li>\n      <li>48 Stunden vor der Behandlung kein Peeling oder starkes Reiben der Brauenhaut.</li>\n    </ul>\n  ",microneedling:"\n    <h4>Microneedling</h4>\n    <p><strong>Nicht geeignet f\xfcr:</strong></p>\n    <ul>\n      <li>Schwangere oder stillende Personen</li>\n      <li>Personen mit aktiven Hautinfektionen, Ekzemen oder offenen Wunden im Behandlungsbereich</li>\n      <li>Personen mit Blutgerinnungsst\xf6rungen oder Einnahme blutverd\xfcnnender Medikamente</li>\n      <li>Personen mit Neigung zu Keloiden oder hypertrophen Narben</li>\n    </ul>\n    <p><strong>7 Tage vor der Behandlung:</strong></p>\n    <ul>\n      <li>Keine Botox-, Filler- oder chemische Peeling-Behandlungen.</li>\n    </ul>\n    <p><strong>24 Stunden vor der Behandlung:</strong></p>\n    <ul>\n      <li>Kein Alkohol, Koffein oder blutverd\xfcnnende Medikamente (z. B. Aspirin) einnehmen.</li>\n      <li>Kein intensives Sonnenbaden oder Solarium.</li>\n    </ul>\n    <p><strong>Wichtiger Hinweis:</strong></p>\n    <ul>\n      <li>Bitte kommen Sie mit gereinigter Haut und ohne Make-up zur Behandlung.</li>\n      <li>Nach der Behandlung kann die Haut leicht ger\xf6tet sein – dies ist normal und klingt in der Regel innerhalb von 24–48 Stunden ab.</li>\n      <li>Planen Sie Ihre Termine so, dass Sie nach der Behandlung mindestens 48 Stunden lang kein Make-up auftragen m\xfcssen.</li>\n    </ul>\n  ",default:"\n    <h4>Behandlungsinformationen</h4>\n    <p>F\xfcr diese Behandlung gibt es keine speziellen Vorbereitungen oder Einschr\xe4nkungen.</p>\n    <p>F\xfcr ein optimales Ergebnis empfehlen wir jedoch:</p>\n    <ul>\n      <li>Kommen Sie entspannt und ausgeruht zur Behandlung</li>\n      <li>Trinken Sie ausreichend Wasser vor Ihrem Termin</li>\n      <li>Informieren Sie uns \xfcber eventuelle Allergien oder Hautempfindlichkeiten</li>\n    </ul>\n    <p>Bei Fragen oder Unsicherheiten kontaktieren Sie uns gerne vor Ihrem Termin unter: <strong>kontakt@sheenberlin.de</strong></p>\n  "};function I(e){let{selectedTreatments:n,onBack:t,onContinue:s}=e,[r,l]=(0,a.useState)(!1);return(0,i.jsxs)("div",{className:"treatment-terms-container",children:[(0,i.jsx)("h3",{className:"heading-tertiary",children:"Behandlungsbedingungen"}),(0,i.jsx)("p",{className:"booking-step-description",children:"Bitte lesen und best\xe4tigen Sie die folgenden Informationen zu Ihren gew\xe4hlten Behandlungen:"}),(0,i.jsx)("div",{className:"terms-content",dangerouslySetInnerHTML:{__html:(()=>{if(!n||0===n.length)return A.default;let e=new Set,t=new Set;return(n.forEach(n=>{let s="",r=n.id;!t.has(r)&&("microblading"===r||"lipblush"===r||"eyeliner"===r?t.has("pmu")||(s=A.pmu,t.add("pmu")):"lash-lifting"===r?t.has("lash-lifting")||(s=A["lash-lifting"],t.add("lash-lifting")):"browlifting"===r?t.has("browlifting")||(s=A.browlifting,t.add("browlifting")):"microneedling"===r?t.has("microneedling")||(s=A.microneedling,t.add("microneedling")):t.has("default")||(s=A.default,t.add("default")),s&&e.add(s))}),0===e.size)?A.default:Array.from(e).join('<hr class="terms-divider" />')})()}}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r&&s()},className:"terms-form",children:[(0,i.jsxs)("div",{className:"form-group checkbox-group",children:[(0,i.jsx)("input",{type:"checkbox",id:"accept-terms",checked:r,onChange:e=>l(e.target.checked),className:"form-checkbox"}),(0,i.jsx)("label",{htmlFor:"accept-terms",className:"checkbox-label",children:"Ich habe die Behandlungsbedingungen gelesen und verstanden *"})]}),!r&&(0,i.jsx)("p",{className:"terms-hint",children:"Bitte best\xe4tigen Sie die Behandlungsbedingungen, um fortzufahren."}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"button",onClick:t,className:"btn btn-secondary",children:"Zur\xfcck"}),(0,i.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:!r,children:"Weiter"})]})]})]})}function E(){return(0,i.jsx)("div",{className:"login-required-container",children:(0,i.jsxs)("div",{className:"login-required-content",children:[(0,i.jsx)("div",{className:"login-required-icon",children:(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-24 w-24 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})}),(0,i.jsx)("h2",{className:"login-required-title",children:"Anmeldung erforderlich"}),(0,i.jsx)("p",{className:"login-required-text",children:"Um einen Termin zu buchen, m\xfcssen Sie sich zuerst anmelden. Nach der Anmeldung k\xf6nnen Sie Ihre Buchung fortsetzen."}),(0,i.jsxs)("div",{className:"login-required-buttons",children:[(0,i.jsx)(l.default,{href:"/login",className:"btn--primary",children:"Anmelden"}),(0,i.jsx)(l.default,{href:"/register",className:"btn--secondary",children:"Registrieren"})]})]})})}function C(){let[e,n]=(0,a.useState)([]),[s,r]=(0,a.useState)({date:null,time:null}),[c,u]=(0,a.useState)({fullName:"",email:"",phone:"",message:""}),[m,g]=(0,a.useState)(0),[h,x]=(0,a.useState)(!1),[p,f]=(0,a.useState)(null),[y,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1);(0,T.useRouter)(),(0,a.useEffect)(()=>{try{{let e=new URLSearchParams(window.location.search),t=e.get("step"),s=e.get("refresh");if("treatments"===t&&(console.log("Direkter Einstieg in die Behandlungsauswahl \xfcber URL-Parameter"),g(0),n([]),r({date:null,time:null}),x(!1),f(null),s)){console.log("\uD83D\uDD04 Refresh-Parameter erkannt ("+s+") - kompletter State-Reset"),u({fullName:"",email:"",phone:"",message:""});let e=new URL(window.location.href);e.searchParams.delete("refresh"),window.history.replaceState({},"",e.toString()),console.log("✅ State komplett zur\xfcckgesetzt, URL bereinigt")}}}catch(e){console.error("Fehler beim Verarbeiten der URL-Parameter:",e)}},[]),(0,a.useEffect)(()=>{let e=(0,N.Aj)(j.I8,async e=>{if(e){w(!0);try{let n=await (0,j.Rf)(e.uid);n&&u({fullName:"".concat(n.firstName," ").concat(n.lastName),email:n.email,phone:n.phone||"",message:""})}catch(e){console.error("Fehler beim Laden der Kundendaten:",e)}}else w(!1)});return()=>e()},[]);let A=e=>{n(n=>n.some(n=>n.id===e.id)?n.filter(n=>n.id!==e.id):[...n,e])},C=()=>{g(e=>e<5?e+1:e)},L=()=>{g(e=>e>0?e-1:e)},M=async()=>{try{var n,r,i;if(S(!0),f(null),!e||0===e.length){f("Bitte w\xe4hlen Sie mindestens eine Behandlung aus."),S(!1);return}if(!s.date||!s.time){f("Bitte w\xe4hlen Sie ein Datum und eine Uhrzeit f\xfcr Ihren Termin."),S(!1);return}let a=e.reduce((e,n)=>e+n.price,0),l=e.reduce((e,n)=>e+n.duration,0),o=a,u=null,m=null;try{let e=sessionStorage.getItem("bookingDataWithDiscount"),n=sessionStorage.getItem("appliedDiscount"),t=sessionStorage.getItem("finalPrice");if(e){let n=JSON.parse(e);o=n.finalPrice||a,u=n.appliedDiscount,m=n.discountInfo,console.log("\uD83D\uDCCA Rabattdaten aus sessionStorage geladen:",{originalPrice:a,finalPrice:o,discount:u,savings:(null==m?void 0:m.amount)||0})}else n&&t&&(u=JSON.parse(n),o=parseFloat(t),console.log("\uD83D\uDCCA Fallback-Rabattdaten geladen:",{originalPrice:a,finalPrice:o,discount:u}))}catch(e){console.error("Fehler beim Lesen der Rabattdaten:",e),o=a}let h=new Date(s.date);h.setHours(0,0,0,0);let p="".concat(h.getFullYear(),"-").concat(String(h.getMonth()+1).padStart(2,"0"),"-").concat(String(h.getDate()).padStart(2,"0")),b={name:c.fullName,email:c.email,phone:c.phone,date:p,time:s.time,service:e[0].id,serviceName:e[0].name,treatments:e,message:c.message||"",price:o,originalPrice:a,appliedDiscount:u,discountInfo:m,duration:l,termsAccepted:!0};if((null==u?void 0:u.isEligible)&&(null===(n=j.I8.currentUser)||void 0===n?void 0:n.uid)){console.log("\uD83D\uDEA8 BLOCKIERE SOFORT weitere Rabatte f\xfcr diesen Benutzer!"),(0,D.DY)(j.I8.currentUser.uid);try{console.log("\uD83C\uDFAF WICHTIG: Setze Treuerabatt zur\xfcck VOR Buchungsbest\xe4tigung");let{updateDoc:e,doc:n,Timestamp:s}=await Promise.resolve().then(t.bind(t,5978)),{db:r}=await Promise.resolve().then(t.bind(t,6108)),i=n(r,"users",j.I8.currentUser.uid);await e(i,{lastDiscountDate:s.now(),isEligibleForLoyaltyDiscount:!1,updatedAt:s.now()}),console.log("✅ Treuerabatt-Reset VOR Buchung erfolgreich")}catch(e){console.error("❌ Fehler beim Treuerabatt-Reset:",e)}}console.log("Buchungsdaten:",b);let v=await (0,d.km)(b);if(v.success){if((null===(r=j.I8.currentUser)||void 0===r?void 0:r.uid)&&!(null==u?void 0:u.isEligible))try{let n=e.length;console.log("\uD83D\uDD22 Erh\xf6he Z\xe4hler um ".concat(n," Behandlungen")),await (0,D.lk)(j.I8.currentUser.uid,n),console.log("✅ Behandlungsz\xe4hler erfolgreich erh\xf6ht")}catch(e){console.error("❌ Fehler beim Erh\xf6hen des Z\xe4hlers:",e)}if((null==u?void 0:u.isEligible)&&v.id)try{console.log("\uD83C\uDFAF Wende Rabatt an f\xfcr Buchung (Tracking):",v.id),await (0,D.tW)((null===(i=j.I8.currentUser)||void 0===i?void 0:i.uid)||"",v.id,u),console.log("✅ Rabatt-Tracking erfolgreich angewendet")}catch(e){console.error("❌ Fehler beim Rabatt-Tracking:",e)}v.error?(console.warn("Buchung mit Warnung erfolgreich:",v.error),f(v.error),x(!0),setTimeout(()=>{g(5)},3e3)):(x(!0),g(5))}else f(v.error||"Es ist ein Fehler aufgetreten. Bitte versuchen Sie es sp\xe4ter erneut."),S(!1)}catch(e){console.error("Fehler bei der Buchungsbest\xe4tigung:",e),e instanceof Error&&(e.toString().includes("permission-denied")||e.toString().includes("permission"))?(f("Die Buchung wurde erfolgreich gespeichert, aber es gab technische Probleme. Sie erhalten demn\xe4chst eine Best\xe4tigungs-E-Mail."),x(!0),setTimeout(()=>{g(5)},5e3)):(f(e instanceof Error?e.message:"Es ist ein unbekannter Fehler aufgetreten. Bitte versuchen Sie es sp\xe4ter erneut."),S(!1))}};return y?(0,i.jsxs)("section",{className:"section section-booking",children:[(0,i.jsxs)(l.default,{href:"/",className:"home-button",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,i.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Home"]}),(0,i.jsx)("div",{className:"container center-text",children:(0,i.jsx)("span",{className:"subheading",children:"Termin Buchen"})}),(0,i.jsx)("div",{className:"container",children:(0,i.jsxs)("div",{className:"booking-container",children:[(0,i.jsx)("div",{className:"booking-progress",children:(0,i.jsx)("div",{className:"progress-bar-container",children:(0,i.jsxs)("div",{className:"progress-steps",children:[(0,i.jsx)("div",{className:"progress-line"}),(0,i.jsx)("div",{className:"progress-line-active",style:{width:"".concat((m-1)/4*100,"%")}}),(0,i.jsxs)("div",{className:"progress-step ".concat(m>=0?"active":""," ").concat(m>0?"completed":""),children:[(0,i.jsx)("div",{className:"step-circle ".concat(m>=0?"active":""," ").concat(m>0?"completed":""),children:m>0?"✓":"1"}),(0,i.jsx)("span",{className:"step-text",children:"Behandlung"})]}),(0,i.jsxs)("div",{className:"progress-step ".concat(m>=1?"active":""," ").concat(m>1?"completed":""),children:[(0,i.jsx)("div",{className:"step-circle ".concat(m>=1?"active":""," ").concat(m>1?"completed":""),children:m>1?"✓":"2"}),(0,i.jsx)("span",{className:"step-text",children:"Termin"})]}),(0,i.jsxs)("div",{className:"progress-step ".concat(m>=2?"active":""," ").concat(m>2?"completed":""),children:[(0,i.jsx)("div",{className:"step-circle ".concat(m>=2?"active":""," ").concat(m>2?"completed":""),children:m>2?"✓":"3"}),(0,i.jsx)("span",{className:"step-text",children:"Pers\xf6nliche Daten"})]}),(0,i.jsxs)("div",{className:"progress-step ".concat(m>=3?"active":""," ").concat(m>3?"completed":""),children:[(0,i.jsx)("div",{className:"step-circle ".concat(m>=3?"active":""," ").concat(m>3?"completed":""),children:m>3?"✓":"4"}),(0,i.jsx)("span",{className:"step-text",children:"Bedingungen"})]}),(0,i.jsxs)("div",{className:"progress-step ".concat(m>=4?"active":""," ").concat(m>4?"completed":""),children:[(0,i.jsx)("div",{className:"step-circle ".concat(m>=4?"active":""," ").concat(m>4?"completed":""),children:m>4?"✓":"5"}),(0,i.jsx)("span",{className:"step-text",children:"\xdcberpr\xfcfen"})]})]})})}),(0,i.jsx)("div",{className:"booking-step-content",children:(()=>{switch(m){case 0:return(0,i.jsx)(b,{selectedTreatments:e,toggleTreatment:A,onContinue:C});case 1:return(0,i.jsx)(v,{selectedTreatments:e,selectedDateTime:s,setSelectedDateTime:r,onBack:L,onContinue:C});case 2:return(0,i.jsx)(o,{customerInfo:c,setCustomerInfo:u,onBack:L,onContinue:C,isLoggedIn:y});case 3:return(0,i.jsx)(I,{selectedTreatments:e,onBack:L,onContinue:C});case 4:return(0,i.jsx)(B,{selectedTreatments:e,selectedDateTime:{date:s.date?s.date.toISOString():"",time:s.time||""},customerInfo:{firstName:c.fullName.split(" ")[0],lastName:c.fullName.split(" ").slice(1).join(" "),email:c.email,phone:c.phone},onBack:L,onConfirm:e=>{e&&e.length>0&&(console.log("Aktualisierte Treatments mit Rabatten empfangen:",e),n(e)),M()},error:p||void 0});case 5:return(0,i.jsx)(F,{selectedTreatments:e,selectedDateTime:{date:s.date,time:s.time||""},customerInfo:c});default:return null}})()})]})})]}):(0,i.jsxs)("section",{className:"section section-booking",children:[(0,i.jsxs)(l.default,{href:"/",className:"home-button",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,i.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Home"]}),(0,i.jsx)("div",{className:"container center-text",children:(0,i.jsx)("span",{className:"subheading",children:"Termin Buchen"})}),(0,i.jsx)("div",{className:"container",children:(0,i.jsx)("div",{className:"booking-container",children:(0,i.jsx)(E,{})})})]})}(s=r||(r={}))[s.TreatmentSelection=0]="TreatmentSelection",s[s.DateTimeSelection=1]="DateTimeSelection",s[s.CustomerForm=2]="CustomerForm",s[s.TreatmentTerms=3]="TreatmentTerms",s[s.Summary=4]="Summary",s[s.Confirmation=5]="Confirmation"},3608:function(e,n,t){"use strict";t.d(n,{IJ:function(){return a},N0:function(){return m},NB:function(){return o},VR:function(){return l},g4:function(){return d},getBlockedTimesForDate:function(){return c},hS:function(){return h},isTimeSlotBlocked:function(){return u},wi:function(){return i}});var s=t(5978),r=t(6108);async function i(e,n,t,i){try{console.log("\uD83D\uDEAB Sperre Datumsbereich: ".concat(e," bis ").concat(n," - Grund: ").concat(t));let a=new Date(e),l=new Date(n);if(a>l)return{success:!1,error:"Startdatum muss vor Enddatum liegen"};let o=Math.ceil((l.getTime()-a.getTime())/864e5)+1;if(o>365)return{success:!1,error:"Maximal 365 Tage k\xf6nnen gleichzeitig gesperrt werden"};let d=0,u=0,m=[],g=new Date(a);for(;g<=l;){let e=g.toISOString().split("T")[0],n=await c(e);if(n.find(e=>e.isFullDay))console.log("⚠️ Tag ".concat(e," bereits gesperrt - \xfcberspringe")),u++,m.push("".concat(e," bereits gesperrt"));else{for(let e of n)!e.isFullDay&&e.id&&await (0,s.oe)((0,s.doc)(r.db,"blocked_times",e.id));await (0,s.ET)((0,s.hJ)(r.db,"blocked_times"),{date:e,isFullDay:!0,reason:t,createdAt:s.Timestamp.now(),createdBy:i}),d++,console.log("✅ Tag ".concat(e," erfolgreich gesperrt"))}g.setDate(g.getDate()+1)}if(0===d)return{success:!1,error:"Alle ".concat(o," Tage waren bereits gesperrt"),blockedDays:0};if(u>0)return{success:!0,error:"".concat(d,"/").concat(o," Tage gesperrt. ").concat(u," bereits gesperrt: ").concat(m.slice(0,3).join(", ")).concat(m.length>3?"...":""),blockedDays:d};return{success:!0,blockedDays:d}}catch(e){return console.error("❌ Fehler beim Sperren des Datumsbereichs:",e),{success:!1,error:"Fehler beim Sperren des Datumsbereichs"}}}async function a(e,n,t){try{console.log("\uD83D\uDEAB Sperre ganzen Tag: ".concat(e," - Grund: ").concat(n));let i=await c(e);if(i.find(e=>e.isFullDay))return{success:!1,error:"Dieser Tag ist bereits vollst\xe4ndig gesperrt"};for(let e of i)!e.isFullDay&&e.id&&await (0,s.oe)((0,s.doc)(r.db,"blocked_times",e.id));return await (0,s.ET)((0,s.hJ)(r.db,"blocked_times"),{date:e,isFullDay:!0,reason:n,createdAt:s.Timestamp.now(),createdBy:t}),console.log("✅ Ganzer Tag erfolgreich gesperrt: ".concat(e)),{success:!0}}catch(e){return console.error("❌ Fehler beim Sperren des ganzen Tags:",e),{success:!1,error:"Fehler beim Sperren des Tages"}}}async function l(e,n,t,i,a){try{console.log("\uD83D\uDEAB Sperre Zeitraum: ".concat(e," ").concat(n,"-").concat(t," - Grund: ").concat(i));let l=await c(e);if(l.find(e=>e.isFullDay))return{success:!1,error:"Dieser Tag ist bereits vollst\xe4ndig gesperrt"};if(l.some(e=>{if(e.isFullDay||!e.startTime||!e.endTime)return!1;let s=g(e.startTime),r=g(e.endTime),i=g(n),a=g(t);return i<r&&a>s}))return{success:!1,error:"Zeitraum \xfcberschneidet sich mit bestehender Sperrung"};return await (0,s.ET)((0,s.hJ)(r.db,"blocked_times"),{date:e,startTime:n,endTime:t,isFullDay:!1,reason:i,createdAt:s.Timestamp.now(),createdBy:a}),console.log("✅ Zeitraum erfolgreich gesperrt: ".concat(e," ").concat(n,"-").concat(t)),{success:!0}}catch(e){return console.error("❌ Fehler beim Sperren des Zeitraums:",e),{success:!1,error:"Fehler beim Sperren des Zeitraums"}}}async function o(e){try{return console.log("✅ Hebe Sperrung auf: ".concat(e)),await (0,s.oe)((0,s.doc)(r.db,"blocked_times",e)),console.log("✅ Sperrung erfolgreich aufgehoben: ".concat(e)),{success:!0}}catch(e){return console.error("❌ Fehler beim Aufheben der Sperrung:",e),{success:!1,error:"Fehler beim Aufheben der Sperrung"}}}async function c(e){try{let n=(0,s.IO)((0,s.hJ)(r.db,"blocked_times"),(0,s.ar)("date","==",e)),t=await (0,s.PL)(n),i=[];return t.forEach(e=>{i.push({id:e.id,...e.data()})}),i.sort((e,n)=>{var t,s,r,i,a,l;let o=(null===(r=e.createdAt)||void 0===r?void 0:null===(s=r.toDate)||void 0===s?void 0:null===(t=s.call(r))||void 0===t?void 0:t.getTime())||0;return((null===(l=n.createdAt)||void 0===l?void 0:null===(a=l.toDate)||void 0===a?void 0:null===(i=a.call(l))||void 0===i?void 0:i.getTime())||0)-o}),i}catch(t){var n;if(console.error("❌ Fehler beim Abrufen der gesperrten Zeiten:",t),null===(n=t.message)||void 0===n?void 0:n.includes("index")){console.warn("⚠️ Firebase Index wird ben\xf6tigt. Verwende einfache Abfrage...");try{let n=await (0,s.PL)((0,s.hJ)(r.db,"blocked_times")),t=[];return n.forEach(n=>{let s={id:n.id,...n.data()};s.date===e&&t.push(s)}),t}catch(e){console.error("❌ Auch Fallback-Abfrage fehlgeschlagen:",e)}}return[]}}async function d(e,n){try{let t=(0,s.IO)((0,s.hJ)(r.db,"blocked_times"),(0,s.ar)("date",">=",e),(0,s.ar)("date","<=",n)),i=await (0,s.PL)(t),a=[];return i.forEach(e=>{a.push({id:e.id,...e.data()})}),a.sort((e,n)=>{var t,s,r,i,a,l;if(e.date!==n.date)return e.date.localeCompare(n.date);let o=(null===(r=e.createdAt)||void 0===r?void 0:null===(s=r.toDate)||void 0===s?void 0:null===(t=s.call(r))||void 0===t?void 0:t.getTime())||0;return((null===(l=n.createdAt)||void 0===l?void 0:null===(a=l.toDate)||void 0===a?void 0:null===(i=a.call(l))||void 0===i?void 0:i.getTime())||0)-o}),a}catch(i){var t;if(console.error("❌ Fehler beim Abrufen der gesperrten Zeiten f\xfcr Bereich:",i),null===(t=i.message)||void 0===t?void 0:t.includes("index")){console.warn("⚠️ Firebase Index wird ben\xf6tigt. Verwende Fallback...");try{let t=await (0,s.PL)((0,s.hJ)(r.db,"blocked_times")),i=[];return t.forEach(t=>{let s={id:t.id,...t.data()};s.date>=e&&s.date<=n&&i.push(s)}),i}catch(e){console.error("❌ Fallback-Abfrage fehlgeschlagen:",e)}}return[]}}async function u(e,n){try{let t=await c(e);if(t.some(e=>e.isFullDay))return!0;let s=g(n);return t.some(e=>{if(e.isFullDay||!e.startTime||!e.endTime)return!1;let n=g(e.startTime),t=g(e.endTime);return s>=n&&s<t})}catch(e){return console.error("❌ Fehler beim Pr\xfcfen der Zeitslot-Sperrung:",e),!1}}async function m(e){try{return(await c(e)).some(e=>e.isFullDay)}catch(e){return console.error("❌ Fehler beim Pr\xfcfen der Ganztags-Sperrung:",e),!1}}function g(e){let[n,t]=e.split(":").map(Number);return 60*n+t}async function h(){try{console.log("\uD83D\uDCCB Lade alle gesperrten Zeiten...");let e=await (0,s.PL)((0,s.hJ)(r.db,"blocked_times")),n=[];return e.forEach(e=>{n.push({id:e.id,...e.data()})}),console.log("\uD83D\uDCCB ".concat(n.length," gesperrte Zeiten gefunden, sortiere manuell...")),n.sort((e,n)=>{var t,s,r,i,a,l;if(e.date!==n.date)return e.date.localeCompare(n.date);let o=(null===(r=e.createdAt)||void 0===r?void 0:null===(s=r.toDate)||void 0===s?void 0:null===(t=s.call(r))||void 0===t?void 0:t.getTime())||0;return((null===(l=n.createdAt)||void 0===l?void 0:null===(a=l.toDate)||void 0===a?void 0:null===(i=a.call(l))||void 0===i?void 0:i.getTime())||0)-o}),console.log("✅ Alle gesperrten Zeiten sortiert: ".concat(n.length," Eintr\xe4ge")),n}catch(n){var e;return console.error("❌ Fehler beim Abrufen aller gesperrten Zeiten:",n),(null===(e=n.message)||void 0===e?void 0:e.includes("index"))&&(console.warn("⚠️ Firebase Index-Problem erkannt. Das ist normal beim ersten Mal."),console.info("\uD83D\uDCA1 Firebase erstellt automatisch Indizes im Hintergrund. Bitte warten Sie einige Minuten.")),[]}}},6880:function(){},5587:function(){}},function(e){e.O(0,[345,60,358,657,432,648,145,108,354,394,971,117,744],function(){return e(e.s=3555)}),_N_E=e.O()}]);