"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{8114:function(e,t,n){n.d(t,{c8:function(){return s},i1:function(){return d},km:function(){return u},m1:function(){return m}});var a=n(5978),o=n(6108),r=n(5695),i=n(1405);function c(e){if(!e)return 0;let[t,n]=e.split(":").map(Number);return 60*t+n}async function l(e,t,n){try{console.log("\uD83D\uDD0D Pr\xfcfe Zeitslot-Konflikt f\xfcr ".concat(e," ").concat(t," (").concat(n," Minuten)"));let r=(0,a.IO)((0,a.hJ)(o.db,"bookings"),(0,a.ar)("date","==",e)),i=await (0,a.PL)(r);if(i.empty)return console.log("✅ Keine Buchungen f\xfcr Datum ".concat(e," gefunden - Zeitslot ist verf\xfcgbar")),!1;let l=c(t),u=l+n;console.log("\uD83D\uDCCA Neue Buchung: Start ".concat(t," (").concat(l," Min), Ende: ").concat(u," Min"));let s=[];for(let t of(i.forEach(e=>{let t=e.data();"cancelled"!==t.status&&(t.id=e.id,s.push(t))}),console.log("\uD83D\uDD04 ".concat(s.length," aktive Buchungen f\xfcr ").concat(e," gefunden")),s)){let e=c(t.time),n=e+t.duration;if(console.log("  Pr\xfcfe gegen: ID ".concat(t.id,", Zeit ").concat(t.time," (").concat(e,"-").concat(n," Min)")),l>=e&&l<n||u>e&&u<=n||l<=e&&u>=n)return console.log("❌ Konflikt gefunden mit Buchung ID ".concat(t.id,": ").concat(t.time," (").concat(t.duration," Min)")),!0}return console.log("✅ Keine Konflikte gefunden f\xfcr ".concat(e," um ").concat(t," - Zeitslot ist verf\xfcgbar")),!1}catch(e){return console.error("❌ Fehler bei der Pr\xfcfung auf Zeitslot-Konflikte:",e),!1}}async function u(e){try{console.log("=========== BUCHUNGSPROZESS START ==========="),console.log("Eingangsdaten f\xfcr saveBooking:",JSON.stringify(e,null,2));let t=o.I8.currentUser;if(console.log("Aktueller Benutzer:",null==t?void 0:t.uid,null==t?void 0:t.email),!t)return console.error("Kein Benutzer angemeldet"),{success:!1,error:"Sie m\xfcssen angemeldet sein, um eine Buchung vorzunehmen."};if(!e.date||!e.time)return console.error("Fehler: Datum oder Uhrzeit fehlt in den Buchungsdaten"),{success:!1,error:"Datum und Uhrzeit sind erforderlich."};if(!e.name||!e.email||!e.phone)return console.error("Fehler: Kundendaten unvollst\xe4ndig"),{success:!1,error:"Bitte f\xfcllen Sie alle Pflichtfelder aus."};if(!e.treatments||0===e.treatments.length)return console.error("Fehler: Keine Behandlungen ausgew\xe4hlt"),{success:!1,error:"Bitte w\xe4hlen Sie mindestens eine Behandlung aus."};if(e.date&&"string"==typeof e.date){let[t,n,a]=e.date.split("-").map(Number),o="".concat(t,"-").concat(String(n).padStart(2,"0"),"-").concat(String(a).padStart(2,"0"));e.date=o,console.log("Formatiertes Buchungsdatum:",o)}try{if(console.log("Pr\xfcfe Verf\xfcgbarkeit f\xfcr ".concat(e.date," um ").concat(e.time)),await l(e.date,e.time,e.duration))return console.error("❌ Zeitslot ".concat(e.date," um ").concat(e.time," ist bereits belegt!")),{success:!1,error:"Der gew\xe4hlte Zeitslot am ".concat(e.date," um ").concat(e.time," Uhr ist bereits belegt. Bitte w\xe4hlen Sie einen anderen Termin.")}}catch(e){console.warn("⚠️ Fehler bei der Pr\xfcfung des Zeitslots:",e)}let n=e.treatments.reduce((e,t)=>e+t.price,0),c=null,u=[...e.treatments];console.log("\uD83C\uDFAF Starte Rabattberechnung f\xfcr Benutzer:",t.uid),console.log("\uD83D\uDCB0 Gesamtpreis vor Rabatt:",n);try{if(c=await (0,i.yX)(t.uid,n),console.log("\uD83C\uDF81 Rabattinfo berechnet:",c),c.isEligible&&c.amount>0){let t=c.amount/n;u=e.treatments.map(e=>({...e,originalPrice:e.price,price:Math.round(e.price*(1-t)*100)/100})),console.log("✅ Preise nach Rabatt angepasst:",u)}await (0,i.JT)(t.uid,{name:e.name,email:e.email})}catch(e){console.error("❌ Fehler bei Rabattberechnung:",e)}let s=[],d="",m=e.time;try{for(let n=0;n<u.length;n++){let r=u[n],i=e.treatments[n],l=(null==c?void 0:c.isEligible)?i.price-r.price:0,g={name:e.name,email:e.email,phone:e.phone,message:e.message||"",date:e.date,time:m,service:r.id,serviceName:r.name,treatments:[r],price:r.price,originalPrice:i.price,duration:r.duration,status:"confirmed",createdAt:a.Timestamp.now(),termsAccepted:!0,userId:t.uid,customerId:t.uid,bookingGroupId:d||"pending",isMultiBooking:e.treatments.length>1,treatmentIndex:n,totalTreatments:e.treatments.length,appliedLoyaltyDiscount:(null==c?void 0:c.type)==="loyalty"&&c.isEligible,loyaltyDiscountAmount:(null==c?void 0:c.type)==="loyalty"?l:0,loyaltyDiscountPercentage:(null==c?void 0:c.type)==="loyalty"?c.percentage:0,appliedBirthdayDiscount:(null==c?void 0:c.type)==="birthday"&&c.isEligible,birthdayDiscountAmount:(null==c?void 0:c.type)==="birthday"?l:0,birthdayDiscountPercentage:(null==c?void 0:c.type)==="birthday"?c.percentage:0,totalSavings:l};console.log("Speichere Buchung mit folgenden Daten:",{email:e.email,userId:t.uid,date:e.date,time:m,service:r.name});let h=await (0,a.ET)((0,a.hJ)(o.db,"bookings"),g);if(console.log("Buchung gespeichert mit ID:",h.id),s.push(h.id),0===n&&(d=h.id,console.log("Hauptbuchungs-ID gesetzt:",d),await (0,a.updateDoc)((0,a.doc)(o.db,"bookings",h.id),{bookingGroupId:d})),n<e.treatments.length-1){let[e,t]=m.split(":").map(Number),n=60*e+t+r.duration,a=Math.floor(n/60),o=n%60;m="".concat(String(a).padStart(2,"0"),":").concat(String(o).padStart(2,"0"))}}try{await (0,r.AH)({...e,id:d,bookingIds:s})||console.warn("⚠️ E-Mails konnten nicht gesendet werden")}catch(e){console.warn("⚠️ Fehler beim Senden der E-Mails:",e)}return{success:!0,id:d,ids:s}}catch(e){if(console.error("❌ Fehler beim Speichern der Buchungen:",e),s.length>0)return{success:!0,id:d,ids:s};return{success:!1,error:e instanceof Error?e.message:"Fehler beim Speichern der Buchung."}}}catch(e){return console.error("❌ Fehler beim Speichern der Buchung:",e),{success:!1,error:e instanceof Error?e.message:"Unbekannter Fehler"}}}async function s(e){try{if(console.log("Suche Buchungen f\xfcr Datum: ".concat(e)),!e.match(/^\d{4}-\d{2}-\d{2}$/))return console.error("Ung\xfcltiges Datumsformat:",e),[];let t=(0,a.IO)((0,a.hJ)(o.db,"bookings"),(0,a.ar)("date","==",e)),n=await (0,a.PL)(t),r=[];n.forEach(e=>{let t=e.data();r.push({...t,id:e.id})}),console.log("".concat(r.length," Buchungen insgesamt f\xfcr Datum ").concat(e," gefunden"));let i=r.filter(e=>"cancelled"!==e.status);return console.log("".concat(i.length," aktive Buchungen (nicht storniert) f\xfcr Datum ").concat(e)),i.forEach((e,t)=>{console.log("Buchung ".concat(t+1,":"),{id:e.id,time:e.time,duration:e.duration,status:e.status})}),i}catch(e){return console.error("Fehler beim Abrufen der Buchungen:",e),[]}}async function d(e,t){try{let n=(0,a.doc)(o.db,"bookings",e);return await (0,a.updateDoc)(n,{status:t,updatedAt:a.Timestamp.now()}),!0}catch(e){return console.error("Fehler beim Aktualisieren des Buchungsstatus:",e),!1}}function m(e,t){try{let n=new Date,[a,o,r]=e.split("-").map(Number),[i,c]=t.split(":").map(Number);return(new Date(a,o-1,r,i,c).getTime()-n.getTime())/36e5>=24}catch(e){return console.error("Fehler beim Pr\xfcfen der Stornierungsfrist:",e),!1}}},5695:function(e,t,n){n.d(t,{AH:function(){return d},LJ:function(){return u},Xb:function(){return m},u2:function(){return c}});let a="service_drz8xtb",o="template_hxneksd",r="template_gwjs37v",i="jjBT0mSIJ15QACfrL";async function c(){try{console.log("\uD83E\uDDEA Teste EmailJS-Konfiguration...");let e=await n.e(595).then(n.bind(n,6595));e.init(i);let t={customer_name:"Test Kunde",customer_email:"test@example.com",customer_phone:"+49 123 456789",booking_id:"TEST-"+Date.now(),service:"Augenbrauen zupfen",date:new Date().toLocaleDateString("de-DE"),time:"14:00",price:"25€",message:"Test-Buchung zur \xdcberpr\xfcfung der E-Mail-Funktionalit\xe4t",salon_name:"Sheen Beauty Studio",salon_address:"Kurf\xfcrstendamm 180, 10707 Berlin",salon_phone:"+49 176-32812602",salon_email:"kontakt@sheenberlin.de",from_name:"Buchungssystem Test",to_name:"Sheen Team",reply_to:"test@example.com"};console.log("\uD83E\uDDEA Teste Admin-Template:",r);let o=await e.send(a,r,t,i);return console.log("✅ EmailJS-Test erfolgreich:",o),200===o.status}catch(e){return console.error("❌ EmailJS-Test fehlgeschlagen:",e),!1}}function l(e){return e.treatments&&e.treatments.length>0?e.treatments.map(e=>"".concat(e.name," (").concat(e.price,"€)")).join(", "):e.serviceName}async function u(e){try{let t=await n.e(595).then(n.bind(n,6595));t.init(i);let r=new Date(e.date),c="".concat(r.getDate().toString().padStart(2,"0"),".").concat((r.getMonth()+1).toString().padStart(2,"0"),".").concat(r.getFullYear()),u={booking_id:e.id||"Noch nicht zugewiesen",service:l(e),date:c,time:e.time,price:"".concat(e.price,"€"),customer_name:e.name,customer_email:e.email,customer_phone:e.phone,message:e.message||"Keine Nachricht",salon_name:"Sheen Beauty Studio",salon_address:"Kurf\xfcrstendamm 180, 10707 Berlin",salon_phone:"+49 176-32812602",salon_email:"kontakt@sheenberlin.de",from_name:"Sheen Beauty Studio",to_name:e.name,reply_to:"kontakt@sheenberlin.de"};console.log("\uD83D\uDCE7 Sende E-Mail an Kunden:",u);let s=await t.send(a,o,u);return console.log("✅ E-Mail an Kunden erfolgreich gesendet!",s.status,s.text),!0}catch(e){return console.error("❌ Fehler beim Senden der Kunden-E-Mail:",e),!1}}async function s(e){try{let t=await n.e(595).then(n.bind(n,6595));t.init(i);let o=new Date(e.date),c="".concat(o.getDate().toString().padStart(2,"0"),".").concat((o.getMonth()+1).toString().padStart(2,"0"),".").concat(o.getFullYear()),u={booking_id:e.id||"Noch nicht zugewiesen",service:l(e),date:c,time:e.time,price:"".concat(e.price,"€"),customer_name:e.name,customer_email:e.email,customer_phone:e.phone,message:e.message||"Keine Nachricht",salon_name:"Sheen Beauty Studio",salon_address:"Kurf\xfcrstendamm 180, 10707 Berlin",salon_phone:"+49 176-32812602",salon_email:"kontakt@sheenberlin.de",from_name:"Buchungssystem",to_name:"Sheen Team",reply_to:e.email};console.log("\uD83D\uDCE7 Sende E-Mail an Admin:",u);let s=await t.send(a,r,u);return console.log("✅ E-Mail an Admin erfolgreich gesendet!",s.status,s.text),!0}catch(e){return console.error("❌ Fehler beim Senden der Admin-E-Mail:",e),!1}}async function d(e){try{console.log("\uD83D\uDD04 Starte E-Mail-Versand...");let t=await u(e);console.log("\uD83D\uDCEB E-Mail an Kunden:",t?"gesendet ✅":"fehlgeschlagen ❌");let n=await s(e);return console.log("\uD83D\uDCEB E-Mail an Admin:",n?"gesendet ✅":"fehlgeschlagen ❌"),t||n}catch(e){return console.error("❌ Unerwarteter Fehler beim E-Mail-Versand:",e),!1}}async function m(e){try{console.log("\uD83D\uDCE7 Sende Kontaktformular-E-Mail direkt an nesa.afshari@web.de...");let t=encodeURIComponent("Kontaktanfrage von ".concat(e.name," - Sheen Beauty Website")),n=encodeURIComponent("\nNeue Kontaktanfrage von der Sheen Beauty Website:\n\n\uD83D\uDC64 Name: ".concat(e.name,"\n\uD83D\uDCE7 E-Mail: ").concat(e.email,"\n\uD83D\uDCC5 Datum: ").concat(new Date().toLocaleDateString("de-DE"),"\n\uD83D\uDD50 Zeit: ").concat(new Date().toLocaleTimeString("de-DE"),"\n\n\uD83D\uDCDD Nachricht:\n").concat(e.message,"\n\n---\nDiese E-Mail wurde automatisch von der Sheen Beauty Website generiert.\nAntworten Sie direkt an: ").concat(e.email,"\n    ")),a="mailto:nesa.afshari@web.de?subject=".concat(t,"&body=").concat(n,"&reply-to=").concat(e.email);console.log("\uD83D\uDCE7 \xd6ffne E-Mail-Client mit mailto-Link...");try{let t=document.createElement("a");t.href=a,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t),console.log("\uD83D\uDCE7 E-Mail-Client ge\xf6ffnet!");let n="An: nesa.afshari@web.de\nBetreff: Kontaktanfrage von ".concat(e.name," - Sheen Beauty Website\n\nNeue Kontaktanfrage von der Sheen Beauty Website:\n\n\uD83D\uDC64 Name: ").concat(e.name,"\n\uD83D\uDCE7 E-Mail: ").concat(e.email,"\n\uD83D\uDCC5 Datum: ").concat(new Date().toLocaleDateString("de-DE"),"\n\uD83D\uDD50 Zeit: ").concat(new Date().toLocaleTimeString("de-DE"),"\n\n\uD83D\uDCDD Nachricht:\n").concat(e.message,"\n\n---\nDiese E-Mail wurde automatisch von der Sheen Beauty Website generiert.\nAntworten Sie direkt an: ").concat(e.email);return navigator.clipboard&&navigator.clipboard.writeText(n).then(()=>{console.log("\uD83D\uDCCB E-Mail-Inhalt in Zwischenablage kopiert (Backup)")}).catch(()=>{console.log("\uD83D\uDCCB Zwischenablage-Kopie fehlgeschlagen")}),!0}catch(t){return console.error("\uD83D\uDCE7 Fehler beim \xd6ffnen des mailto-Links:",t),alert("Bitte senden Sie eine E-Mail an: nesa.afshari@web.de\n\nBetreff: Kontaktanfrage von ".concat(e.name,"\n\nIhre Nachricht: ").concat(e.message)),!0}}catch(t){console.error("\uD83D\uDCE7 Fehler beim \xd6ffnen des E-Mail-Clients:",t);try{console.log("\uD83D\uDCE7 Fallback: Versuche EmailJS als Backup...");let t=await n.e(595).then(n.bind(n,6595));t.init(i);let o={customer_name:e.name,customer_email:e.email,service_name:"\uD83D\uDD14 Kontaktanfrage von Website",booking_date:new Date().toLocaleDateString("de-DE"),booking_time:new Date().toLocaleTimeString("de-DE"),message:'\uD83D\uDCE8 Kontaktformular-Nachricht:\n\n"'.concat(e.message,'"\n\n\uD83D\uDC64 Absender: ').concat(e.name,"\n\uD83D\uDCE7 E-Mail: ").concat(e.email),price:"0 €",phone:"\xdcber Kontaktformular",timestamp:new Date().toLocaleString("de-DE"),to_name:"Nesa Afshari",reply_to:e.email},c=await t.send(a,r,o,i);return console.log("\uD83D\uDCE7 Fallback-E-Mail erfolgreich gesendet:",c),200===c.status}catch(e){return console.error("\uD83D\uDCE7 Auch Fallback fehlgeschlagen:",e),!1}}}console.log("\uD83D\uDCE7 EmailJS Konfiguration aktualisiert:",{serviceId:a,publicKey:i.substring(0,8)+"...",templates:{customer:o+" (Terminbest\xe4tigung Kunde)",admin:r+" (Terminbuchung Admin)",contact:"template_contact"},status:"✅ Konfiguration bereit f\xfcr Tests"})},7644:function(e,t,n){n.d(t,{T4:function(){return r},jE:function(){return i}});let a=e=>e/1.19,o=e=>e-a(e),r=e=>"".concat(e.toFixed(2)," €"),i=e=>{let t=a(e),n=o(e);return{gross:e,net:t,vat:n,grossFormatted:r(e),netFormatted:r(t),vatFormatted:r(n)}}}}]);