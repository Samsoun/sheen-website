"use strict";exports.id=669,exports.ids=[669],exports.modules={6967:(e,t,n)=>{n.d(t,{c8:()=>c,i1:()=>d,km:()=>u,m1:()=>m});var r=n(76),a=n(5920),i=n(4211),o=n(4419);function s(e){if(!e)return 0;let[t,n]=e.split(":").map(Number);return 60*t+n}async function l(e,t,n){try{console.log(`üîç Pr\xfcfe Zeitslot-Konflikt f\xfcr ${e} ${t} (${n} Minuten)`);let i=(0,r.IO)((0,r.hJ)(a.db,"bookings"),(0,r.ar)("date","==",e)),o=await (0,r.PL)(i);if(o.empty)return console.log(`‚úÖ Keine Buchungen f\xfcr Datum ${e} gefunden - Zeitslot ist verf\xfcgbar`),!1;let l=s(t),u=l+n;console.log(`üìä Neue Buchung: Start ${t} (${l} Min), Ende: ${u} Min`);let c=[];for(let t of(o.forEach(e=>{let t=e.data();"cancelled"!==t.status&&(t.id=e.id,c.push(t))}),console.log(`üîÑ ${c.length} aktive Buchungen f\xfcr ${e} gefunden`),c)){let e=s(t.time),n=e+t.duration;if(console.log(`  Pr\xfcfe gegen: ID ${t.id}, Zeit ${t.time} (${e}-${n} Min)`),l>=e&&l<n||u>e&&u<=n||l<=e&&u>=n)return console.log(`‚ùå Konflikt gefunden mit Buchung ID ${t.id}: ${t.time} (${t.duration} Min)`),!0}return console.log(`‚úÖ Keine Konflikte gefunden f\xfcr ${e} um ${t} - Zeitslot ist verf\xfcgbar`),!1}catch(e){return console.error("‚ùå Fehler bei der Pr\xfcfung auf Zeitslot-Konflikte:",e),!1}}async function u(e){try{console.log("=========== BUCHUNGSPROZESS START ==========="),console.log("Eingangsdaten f\xfcr saveBooking:",JSON.stringify(e,null,2));let t=a.I8.currentUser;if(console.log("Aktueller Benutzer:",t?.uid,t?.email),!t)return console.error("Kein Benutzer angemeldet"),{success:!1,error:"Sie m\xfcssen angemeldet sein, um eine Buchung vorzunehmen."};if(!e.date||!e.time)return console.error("Fehler: Datum oder Uhrzeit fehlt in den Buchungsdaten"),{success:!1,error:"Datum und Uhrzeit sind erforderlich."};if(!e.name||!e.email||!e.phone)return console.error("Fehler: Kundendaten unvollst\xe4ndig"),{success:!1,error:"Bitte f\xfcllen Sie alle Pflichtfelder aus."};if(!e.treatments||0===e.treatments.length)return console.error("Fehler: Keine Behandlungen ausgew\xe4hlt"),{success:!1,error:"Bitte w\xe4hlen Sie mindestens eine Behandlung aus."};if(e.date&&"string"==typeof e.date){let[t,n,r]=e.date.split("-").map(Number),a=`${t}-${String(n).padStart(2,"0")}-${String(r).padStart(2,"0")}`;e.date=a,console.log("Formatiertes Buchungsdatum:",a)}try{if(console.log(`Pr\xfcfe Verf\xfcgbarkeit f\xfcr ${e.date} um ${e.time}`),await l(e.date,e.time,e.duration))return console.error(`‚ùå Zeitslot ${e.date} um ${e.time} ist bereits belegt!`),{success:!1,error:`Der gew\xe4hlte Zeitslot am ${e.date} um ${e.time} Uhr ist bereits belegt. Bitte w\xe4hlen Sie einen anderen Termin.`}}catch(e){console.warn("‚ö†Ô∏è Fehler bei der Pr\xfcfung des Zeitslots:",e)}let n=e.treatments.reduce((e,t)=>e+t.price,0),s=null,u=[...e.treatments];console.log("\uD83C\uDFAF Starte Rabattberechnung f\xfcr Benutzer:",t.uid),console.log("\uD83D\uDCB0 Gesamtpreis vor Rabatt:",n);try{if(s=await (0,o.yX)(t.uid,n),console.log("\uD83C\uDF81 Rabattinfo berechnet:",s),s.isEligible&&s.amount>0){let t=s.amount/n;u=e.treatments.map(e=>({...e,originalPrice:e.price,price:Math.round(e.price*(1-t)*100)/100})),console.log("‚úÖ Preise nach Rabatt angepasst:",u)}await (0,o.JT)(t.uid,{name:e.name,email:e.email})}catch(e){console.error("‚ùå Fehler bei Rabattberechnung:",e)}let c=[],d="",m=e.time;try{for(let n=0;n<u.length;n++){let i=u[n],o=e.treatments[n],l=s?.isEligible?o.price-i.price:0,g={name:e.name,email:e.email,phone:e.phone,message:e.message||"",date:e.date,time:m,service:i.id,serviceName:i.name,treatments:[i],price:i.price,originalPrice:o.price,duration:i.duration,status:"confirmed",createdAt:r.Timestamp.now(),termsAccepted:!0,userId:t.uid,customerId:t.uid,bookingGroupId:d||"pending",isMultiBooking:e.treatments.length>1,treatmentIndex:n,totalTreatments:e.treatments.length,appliedLoyaltyDiscount:s?.type==="loyalty"&&s.isEligible,loyaltyDiscountAmount:s?.type==="loyalty"?l:0,loyaltyDiscountPercentage:s?.type==="loyalty"?s.percentage:0,appliedBirthdayDiscount:s?.type==="birthday"&&s.isEligible,birthdayDiscountAmount:s?.type==="birthday"?l:0,birthdayDiscountPercentage:s?.type==="birthday"?s.percentage:0,totalSavings:l};console.log("Speichere Buchung mit folgenden Daten:",{email:e.email,userId:t.uid,date:e.date,time:m,service:i.name});let h=await (0,r.ET)((0,r.hJ)(a.db,"bookings"),g);if(console.log("Buchung gespeichert mit ID:",h.id),c.push(h.id),0===n&&(d=h.id,console.log("Hauptbuchungs-ID gesetzt:",d),await (0,r.updateDoc)((0,r.doc)(a.db,"bookings",h.id),{bookingGroupId:d})),n<e.treatments.length-1){let[e,t]=m.split(":").map(Number),n=60*e+t+i.duration,r=Math.floor(n/60),a=n%60;m=`${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}`}}try{await (0,i.AH)({...e,id:d,bookingIds:c})||console.warn("‚ö†Ô∏è E-Mails konnten nicht gesendet werden")}catch(e){console.warn("‚ö†Ô∏è Fehler beim Senden der E-Mails:",e)}return{success:!0,id:d,ids:c}}catch(e){if(console.error("‚ùå Fehler beim Speichern der Buchungen:",e),c.length>0)return{success:!0,id:d,ids:c};return{success:!1,error:e instanceof Error?e.message:"Fehler beim Speichern der Buchung."}}}catch(e){return console.error("‚ùå Fehler beim Speichern der Buchung:",e),{success:!1,error:e instanceof Error?e.message:"Unbekannter Fehler"}}}async function c(e){try{if(console.log(`Suche Buchungen f\xfcr Datum: ${e}`),!e.match(/^\d{4}-\d{2}-\d{2}$/))return console.error("Ung\xfcltiges Datumsformat:",e),[];let t=(0,r.IO)((0,r.hJ)(a.db,"bookings"),(0,r.ar)("date","==",e)),n=await (0,r.PL)(t),i=[];n.forEach(e=>{let t=e.data();i.push({...t,id:e.id})}),console.log(`${i.length} Buchungen insgesamt f\xfcr Datum ${e} gefunden`);let o=i.filter(e=>"cancelled"!==e.status);return console.log(`${o.length} aktive Buchungen (nicht storniert) f\xfcr Datum ${e}`),o.forEach((e,t)=>{console.log(`Buchung ${t+1}:`,{id:e.id,time:e.time,duration:e.duration,status:e.status})}),o}catch(e){return console.error("Fehler beim Abrufen der Buchungen:",e),[]}}async function d(e,t){try{let n=(0,r.doc)(a.db,"bookings",e);return await (0,r.updateDoc)(n,{status:t,updatedAt:r.Timestamp.now()}),!0}catch(e){return console.error("Fehler beim Aktualisieren des Buchungsstatus:",e),!1}}function m(e,t){try{let n=new Date,[r,a,i]=e.split("-").map(Number),[o,s]=t.split(":").map(Number);return(new Date(r,a-1,i,o,s).getTime()-n.getTime())/36e5>=24}catch(e){return console.error("Fehler beim Pr\xfcfen der Stornierungsfrist:",e),!1}}},4211:(e,t,n)=>{n.d(t,{AH:()=>d,LJ:()=>u,Xb:()=>m,u2:()=>s});let r="service_drz8xtb",a="template_hxneksd",i="template_gwjs37v",o="jjBT0mSIJ15QACfrL";async function s(){try{return console.log("\uD83E\uDDEA Teste EmailJS-Konfiguration..."),console.warn("\uD83E\uDDEA Test nur im Browser m\xf6glich"),!1}catch(e){return console.error("‚ùå EmailJS-Test fehlgeschlagen:",e),!1}}function l(e){return e.treatments&&e.treatments.length>0?e.treatments.map(e=>`${e.name} (${e.price}‚Ç¨)`).join(", "):e.serviceName}async function u(e){try{let t=await n.e(445).then(n.bind(n,7445));t.init(o);let i=new Date(e.date),s=`${i.getDate().toString().padStart(2,"0")}.${(i.getMonth()+1).toString().padStart(2,"0")}.${i.getFullYear()}`,u={booking_id:e.id||"Noch nicht zugewiesen",service:l(e),date:s,time:e.time,price:`${e.price}‚Ç¨`,customer_name:e.name,customer_email:e.email,customer_phone:e.phone,message:e.message||"Keine Nachricht",salon_name:"Sheen Beauty Studio",salon_address:"Kurf\xfcrstendamm 180, 10707 Berlin",salon_phone:"+49 176-32812602",salon_email:"kontakt@sheenberlin.de",from_name:"Sheen Beauty Studio",to_name:e.name,reply_to:"kontakt@sheenberlin.de"};console.log("\uD83D\uDCE7 Sende E-Mail an Kunden:",u);let c=await t.send(r,a,u);return console.log("‚úÖ E-Mail an Kunden erfolgreich gesendet!",c.status,c.text),!0}catch(e){return console.error("‚ùå Fehler beim Senden der Kunden-E-Mail:",e),!1}}async function c(e){try{let t=await n.e(445).then(n.bind(n,7445));t.init(o);let a=new Date(e.date),s=`${a.getDate().toString().padStart(2,"0")}.${(a.getMonth()+1).toString().padStart(2,"0")}.${a.getFullYear()}`,u={booking_id:e.id||"Noch nicht zugewiesen",service:l(e),date:s,time:e.time,price:`${e.price}‚Ç¨`,customer_name:e.name,customer_email:e.email,customer_phone:e.phone,message:e.message||"Keine Nachricht",salon_name:"Sheen Beauty Studio",salon_address:"Kurf\xfcrstendamm 180, 10707 Berlin",salon_phone:"+49 176-32812602",salon_email:"kontakt@sheenberlin.de",from_name:"Buchungssystem",to_name:"Sheen Team",reply_to:e.email};console.log("\uD83D\uDCE7 Sende E-Mail an Admin:",u);let c=await t.send(r,i,u);return console.log("‚úÖ E-Mail an Admin erfolgreich gesendet!",c.status,c.text),!0}catch(e){return console.error("‚ùå Fehler beim Senden der Admin-E-Mail:",e),!1}}async function d(e){try{console.log("\uD83D\uDD04 Starte E-Mail-Versand...");let t=await u(e);console.log("\uD83D\uDCEB E-Mail an Kunden:",t?"gesendet ‚úÖ":"fehlgeschlagen ‚ùå");let n=await c(e);return console.log("\uD83D\uDCEB E-Mail an Admin:",n?"gesendet ‚úÖ":"fehlgeschlagen ‚ùå"),t||n}catch(e){return console.error("‚ùå Unerwarteter Fehler beim E-Mail-Versand:",e),!1}}async function m(e){try{return console.log("\uD83D\uDCE7 Sende Kontaktformular-E-Mail direkt an nesa.afshari@web.de..."),encodeURIComponent(`Kontaktanfrage von ${e.name} - Sheen Beauty Website`),encodeURIComponent(`
Neue Kontaktanfrage von der Sheen Beauty Website:

üë§ Name: ${e.name}
üìß E-Mail: ${e.email}
üìÖ Datum: ${new Date().toLocaleDateString("de-DE")}
üïê Zeit: ${new Date().toLocaleTimeString("de-DE")}

üìù Nachricht:
${e.message}

---
Diese E-Mail wurde automatisch von der Sheen Beauty Website generiert.
Antworten Sie direkt an: ${e.email}
    `),e.email,console.warn("\uD83D\uDCE7 Nicht im Browser - kann mailto-Link nicht \xf6ffnen"),!1}catch(e){console.error("\uD83D\uDCE7 Fehler beim \xd6ffnen des E-Mail-Clients:",e);try{return console.log("\uD83D\uDCE7 Fallback: Versuche EmailJS als Backup..."),!1}catch(e){return console.error("\uD83D\uDCE7 Auch Fallback fehlgeschlagen:",e),!1}}}console.log("\uD83D\uDCE7 EmailJS Konfiguration aktualisiert:",{serviceId:r,publicKey:o?.substring(0,8)+"...",templates:{customer:a+" (Terminbest\xe4tigung Kunde)",admin:i+" (Terminbuchung Admin)",contact:"template_contact"},status:"‚úÖ Konfiguration bereit f\xfcr Tests"})},1037:(e,t,n)=>{n.d(t,{T4:()=>i,jE:()=>o});let r=e=>e/1.19,a=e=>e-r(e),i=e=>`${e.toFixed(2)} ‚Ç¨`,o=e=>{let t=r(e),n=a(e);return{gross:e,net:t,vat:n,grossFormatted:i(e),netFormatted:i(t),vatFormatted:i(n)}}}};