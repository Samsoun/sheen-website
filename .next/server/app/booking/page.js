(()=>{var e={};e.id=355,e.ids=[355],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4770:e=>{"use strict";e.exports=require("crypto")},665:e=>{"use strict";e.exports=require("dns")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},2694:e=>{"use strict";e.exports=require("http2")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},5816:e=>{"use strict";e.exports=require("process")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},6207:(e,n,t)=>{"use strict";t.r(n),t.d(n,{GlobalError:()=>a.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>g,tree:()=>c}),t(1232),t(8679),t(7919),t(5866);var s=t(3191),r=t(8716),i=t(7922),a=t.n(i),l=t(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(n,o);let c=["",{children:["booking",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1232)),"/Users/sbehaein/Desktop/Sheenweb2 Versionen/Version mit login (18.03.2025)/src/app/booking/page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,8679)),"/Users/sbehaein/Desktop/Sheenweb2 Versionen/Version mit login (18.03.2025)/src/app/booking/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,7919)),"/Users/sbehaein/Desktop/Sheenweb2 Versionen/Version mit login (18.03.2025)/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/sbehaein/Desktop/Sheenweb2 Versionen/Version mit login (18.03.2025)/src/app/booking/page.tsx"],m="/booking/page",u={require:t,loadChunk:()=>Promise.resolve()},g=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/booking/page",pathname:"/booking",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1066:(e,n,t)=>{Promise.resolve().then(t.bind(t,9013))},7765:()=>{},9013:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>A});var s,r=t(326),i=t(7577),a=t(434);function l({customerInfo:e,setCustomerInfo:n,onBack:t,onContinue:s,isLoggedIn:a=!1}){let[l,o]=(0,i.useState)({fullName:"",email:"",phone:""}),c=e=>{let{name:t,value:s}=e.target;if("fullName"===t){let e=s.replace(/[^a-zA-ZÃ¤Ã¶Ã¼Ã„Ã–ÃœÃŸ\s]/g,"");n(n=>({...n,[t]:e}))}else if("phone"===t){let e=s.replace(/[^\d+\s]/g,"");n(n=>({...n,[t]:e}))}else n(e=>({...e,[t]:s}));l[t]&&o(e=>({...e,[t]:""}))},d=()=>{let n=!0,t={fullName:"",email:"",phone:""};return e.fullName.trim()?/^[a-zA-ZÃ¤Ã¶Ã¼Ã„Ã–ÃœÃŸ\s]+$/.test(e.fullName)?e.fullName.trim().includes(" ")?e.fullName.trim().split(" ").filter(e=>e.length>0).length<2&&(t.fullName="Bitte geben Sie Vor- und Nachname ein",n=!1):(t.fullName="Bitte geben Sie Vor- und Nachname ein",n=!1):(t.fullName="Der Name darf nur Buchstaben enthalten",n=!1):(t.fullName="Bitte geben Sie Ihren Namen ein",n=!1),e.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="Bitte geben Sie eine g\xfcltige E-Mail-Adresse ein",n=!1):(t.email="Bitte geben Sie Ihre E-Mail-Adresse ein",n=!1),e.phone.trim()?/^[\d+\s]+$/.test(e.phone)||(t.phone="Die Telefonnummer darf nur Zahlen enthalten",n=!1):(t.phone="Bitte geben Sie Ihre Telefonnummer ein",n=!1),o(t),n};return(0,r.jsxs)("div",{className:"booking-form-container",children:[r.jsx("h3",{className:"heading-tertiary",children:"Pers\xf6nliche Daten"}),a?r.jsx("p",{className:"booking-step-description",children:"Sie sind angemeldet. Ihre pers\xf6nlichen Daten wurden automatisch ausgef\xfcllt und k\xf6nnen bei Bedarf bearbeitet werden."}):r.jsx("p",{className:"booking-step-description",children:"Bitte geben Sie Ihre Kontaktdaten an, damit wir Ihren Termin best\xe4tigen k\xf6nnen."}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()&&s()},className:"booking-form",children:[(0,r.jsxs)("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"fullName",className:"form-label",children:"Vollst\xe4ndiger Name *"}),r.jsx("input",{type:"text",id:"fullName",name:"fullName",value:e.fullName,onChange:c,className:`form-input ${l.fullName?"input-error":""}`,placeholder:"Vor- und Nachname"}),l.fullName&&r.jsx("span",{className:"error-message",children:l.fullName})]}),(0,r.jsxs)("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"email",className:"form-label",children:"E-Mail *"}),r.jsx("input",{type:"email",id:"email",name:"email",value:e.email,onChange:c,className:`form-input ${l.email?"input-error":""}`,placeholder:"ihre-email@beispiel.de"}),l.email&&r.jsx("span",{className:"error-message",children:l.email})]}),(0,r.jsxs)("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"phone",className:"form-label",children:"Telefonnummer *"}),r.jsx("input",{type:"tel",id:"phone",name:"phone",value:e.phone,onChange:c,className:`form-input ${l.phone?"input-error":""}`,placeholder:"+49 123 456789"}),l.phone&&r.jsx("span",{className:"error-message",children:l.phone})]}),(0,r.jsxs)("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"message",className:"form-label",children:"Nachricht (optional)"}),r.jsx("textarea",{id:"message",name:"message",value:e.message,onChange:c,className:"form-textarea",placeholder:"Besondere W\xfcnsche oder Anmerkungen",rows:4})]}),(0,r.jsxs)("div",{className:"form-actions",children:[r.jsx("button",{type:"button",onClick:t,className:"btn btn-secondary",children:"Zur\xfcck"}),r.jsx("button",{type:"submit",className:"btn btn-primary",children:"Weiter"})]})]})]})}t(400);var o=t(6226),c=t(6967),d=t(4293);let m={start:9,end:18};function u(){let e=[],n=60*m.start,t=60*m.end;for(let s=n;s<t;s+=15){let n=Math.floor(s/60),t=s%60,r=`${n.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;e.push(r)}return e}function g(e){if(!e)return 0;let[n,t]=e.split(":").map(Number);return 60*n+t}async function h(e,n){try{let t=function(e){let n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${t}-${s}`}(e);if(console.log("getAvailableTimeSlots f\xfcr Datum:",t),await (0,d.N0)(t))return console.log(`âŒ Ganzer Tag gesperrt: ${t}`),[];let s=await (0,c.c8)(t);console.log(`Anzahl Buchungen f\xfcr ${t}:`,s.length);let r=await (0,d.getBlockedTimesForDate)(t);console.log(`Anzahl gesperrte Zeiten f\xfcr ${t}:`,r.length),s.forEach((e,n)=>{var t;console.log(`Buchung ${n+1}: ${e.time}-${(t=g(e.time)+e.duration,`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`)}`)}),r.forEach((e,n)=>{e.isFullDay?console.log(`Gesperrt ${n+1}: Ganzer Tag - ${e.reason}`):console.log(`Gesperrt ${n+1}: ${e.startTime}-${e.endTime} - ${e.reason}`)});let i=u();console.log(`Pr\xfcfe ${i.length} m\xf6gliche Zeitslots auf Konflikte...`);let a=new Date,l=e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear(),o=60*a.getHours()+a.getMinutes(),h=[];for(let e of i){if(l&&g(e)<=o+30){console.log(`Slot ${e} liegt in der Vergangenheit oder ist zu nah an der aktuellen Zeit`);continue}if(await (0,d.isTimeSlotBlocked)(t,e)){console.log(`ðŸš« Slot ${e} ist vom Admin gesperrt`);continue}(function(e,n,t){if(!n||0===n.length)return!1;console.log(`Pr\xfcfe Slot ${e} gegen ${n.length} bestehende Buchungen`);let s=g(e),r=s+t;for(let t of n){if(!t.time||"number"!=typeof t.duration){console.warn("Ung\xfcltige Buchungsdaten:",t);continue}let n=g(t.time),i=n+t.duration;if(s>=n&&s<i||r>n&&r<=i||s<=n&&r>=i)return console.log(`Konflikt: Slot ${e} \xfcberschneidet sich mit Buchung um ${t.time} (${t.duration} Min)`),!0}return!1})(e,s,n)?console.log(`ðŸ“… Slot ${e} ist bereits belegt`):h.push(e)}let x=60*m.end-n,p=h.filter(e=>g(e)<=x);return console.log(`âœ… Insgesamt ${p.length} verf\xfcgbare Zeitslots gefunden (nach Abzug gesperrter Zeiten)`),p}catch(e){return console.error("Fehler beim Abrufen der verf\xfcgbaren Zeitslots:",e),[]}}u().map(e=>({time:e,duration:120,daysAvailable:[1,2,3,4,5,6]}));let x=[{id:"browlifting",name:"Browlifting",category:"Augenbrauen",description:"Ein Lifting f\xfcr Ihre Augenbrauen, bei dem wir in mehreren Schritten Ihre H\xe4rchen nach oben formen und fixieren. Das Ergebnis sind wundervolle, offene Augen und definierte Augenbrauen f\xfcr bis zu 8 Wochen!",duration:75,price:65,image:"/img/Services/browlifting.jpg"},{id:"browdesign",name:"Brow Design",category:"Augenbrauen",description:"Beim Brow Design werden Ihre Augenbrauen professionell gezupft und in Form gebracht. Wir arbeiten nach den individuellen Gesichtsproportionen f\xfcr ein perfektes und nat\xfcrliches Ergebnis.",duration:30,price:25,image:"/img/Services/browdesign.jpg"},{id:"lashlifting",name:"Lash Lifting",category:"Wimpern",description:"Beim Lash Lifting verwenden wir eine spezielle Technik, um Ihren nat\xfcrlichen Wimpern mehr Schwung und L\xe4nge zu verleihen. Genie\xdfen Sie bis zu 8 Wochen lang wundersch\xf6n geschwungene Wimpern!",duration:60,price:65,image:"/img/Services/lashlifting.jpg"},{id:"lipblush",name:"LipBlush",category:"Lippen",description:"Eine semipermanente Pigmentierung der Lippen, die Ihnen voller aussehende, nat\xfcrlich sch\xf6ne Lippen verleiht. Die Farbe wird individuell auf Ihren Hautton abgestimmt.",duration:120,price:350,image:"/img/Services/lipblush.jpg"},{id:"microblading",name:"Microblading",category:"Augenbrauen",description:"Microblading ist eine semipermanente Pigmentierungstechnik, bei der mit feinen Nadeln haard\xfcnne Striche in die Haut gezeichnet werden. Die Augenbrauen wirken nat\xfcrlich, definiert und ausdrucksstark.",duration:120,price:350,image:"/img/Services/microblading.jpg"},{id:"eyeliner",name:"Eyeliner",category:"Augen",description:"Permanenter Eyeliner f\xfcr einen dauerhaft definierten Blick. Der Farbverlauf wird individuell an Ihre Augenform angepasst und betont auf nat\xfcrliche Weise Ihre Augen.",duration:120,price:350,image:"/img/Services/eyeliner.jpg"},{id:"microneedling",name:"Microneedling",category:"Haut",description:"Microneedling ist ein Verfahren, bei dem kleine Nadeln die Haut oberfl\xe4chlich perforieren, um die Kollagenproduktion anzuregen. Dadurch wird die Hautstruktur verbessert und Falten reduziert.",duration:60,price:149,image:"/img/Services/microneedeling.jpg"}];var p=t(1037);function b({selectedTreatments:e,toggleTreatment:n,onContinue:t}){let[s,a]=(0,i.useState)("all"),[l,c]=(0,i.useState)(x),[d,m]=(0,i.useState)({}),u=n=>e.some(e=>e.id===n);e.reduce((e,n)=>e+n.duration,0);let g=e.reduce((e,n)=>e+n.price,0),h=(0,p.jE)(g),b=e=>{m(n=>({...n,[e]:!n[e]}))},f=e.length>0,j=Array.from(new Set(x.map(e=>e.category)));return(0,r.jsxs)("div",{className:"treatments-container",children:[r.jsx("h3",{className:"heading-tertiary",children:"Behandlungen"}),r.jsx("p",{className:"booking-step-description",children:"W\xe4hlen Sie eine oder mehrere Behandlungen aus, die Sie buchen m\xf6chten."}),(0,r.jsxs)("div",{className:"category-tabs",children:[r.jsx("button",{className:`category-tab ${"all"===s?"active":""}`,onClick:()=>a("all"),children:"Alle"},"all"),j.map(e=>r.jsx("button",{className:`category-tab ${s===e?"active":""}`,onClick:()=>a(e),children:e},e))]}),r.jsx("div",{className:"treatments-grid",children:l.map(e=>{let t=u(e.id),s=e.image,i=(0,p.jE)(e.price),a=d[e.id]||!1;return(0,r.jsxs)("div",{className:`treatment-card ${t?"selected":""}`,children:[(0,r.jsxs)("div",{className:"treatment-image",onClick:()=>n({id:e.id,name:e.name,duration:e.duration,price:e.price}),children:[r.jsx(o.default,{src:s,alt:e.name,fill:!0,sizes:"(max-width: 768px) 100vw, 300px",style:{objectFit:"cover"},onError:n=>{n.target.src=`https://via.placeholder.com/400x250/b2d8db/333333?text=${encodeURIComponent(e.name)}`}}),t&&r.jsx("div",{className:"selected-overlay",children:"âœ“"})]}),(0,r.jsxs)("div",{className:"treatment-info",onClick:()=>n({id:e.id,name:e.name,duration:e.duration,price:e.price}),children:[r.jsx("h4",{className:"treatment-name",children:e.name}),r.jsx("p",{className:"treatment-description",children:e.description}),(0,r.jsxs)("div",{className:"treatment-meta",children:[(0,r.jsxs)("span",{className:"treatment-duration",children:[e.duration," Min."]}),(0,r.jsxs)("div",{className:"treatment-price-container",children:[r.jsx("span",{className:"treatment-price",children:i.grossFormatted}),r.jsx("button",{className:"price-details-button",onClick:n=>{n.stopPropagation(),b(e.id)},children:a?"â–²":"â–¼"})]})]}),a&&(0,r.jsxs)("div",{className:"price-breakdown",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"price-row",children:[r.jsx("span",{children:"Netto:"}),r.jsx("span",{children:i.netFormatted})]}),(0,r.jsxs)("div",{className:"price-row",children:[r.jsx("span",{children:"MwSt (19%):"}),r.jsx("span",{children:i.vatFormatted})]}),(0,r.jsxs)("div",{className:"price-row",children:[r.jsx("span",{children:"Brutto:"}),r.jsx("span",{children:i.grossFormatted})]})]})]})]},e.id)})}),e.length>0&&(0,r.jsxs)("div",{className:"treatment-summary",children:[r.jsx("h4",{className:"summary-title",children:"Ihre Auswahl"}),r.jsx("div",{className:"summary-items",children:e.map(e=>{let n=(0,p.jE)(e.price);return(0,r.jsxs)("div",{className:"summary-item",children:[r.jsx("span",{children:e.name}),r.jsx("span",{children:n.grossFormatted})]},e.id)})}),(0,r.jsxs)("div",{className:"price-breakdown-summary",children:[(0,r.jsxs)("div",{className:"price-row",children:[r.jsx("span",{children:"Netto-Gesamt:"}),r.jsx("span",{children:h.netFormatted})]}),(0,r.jsxs)("div",{className:"price-row",children:[r.jsx("span",{children:"MwSt (19%):"}),r.jsx("span",{children:h.vatFormatted})]}),(0,r.jsxs)("div",{className:"summary-total",children:[r.jsx("span",{children:"Brutto-Gesamtpreis:"}),r.jsx("span",{children:h.grossFormatted})]})]})]}),r.jsx("div",{className:"form-actions",children:r.jsx("button",{type:"button",onClick:t,className:"btn btn-primary",disabled:!f,children:"Weiter"})})]})}function f({selectedTreatments:e,selectedDateTime:n,setSelectedDateTime:s,onBack:a,onContinue:l}){let[o,d]=(0,i.useState)([]),[m,x]=(0,i.useState)([]),[p,b]=(0,i.useState)([]),[f,j]=(0,i.useState)(new Date),[v,N]=(0,i.useState)(!1),[y,w]=(0,i.useState)(null),[k,S]=(0,i.useState)([]),[D,B]=(0,i.useState)(!1),T=e.reduce((e,n)=>e+n.duration,0),F=e=>{let n=new Date(e);n.setHours(0,0,0,0);let t=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${t}-${s}-${r}`},$=(e,n,t)=>{let s=g(e),r=s+t;return n.some(e=>{if(!e.time||"number"!=typeof e.duration)return console.warn("Ung\xfcltige Buchungsdaten:",e),!1;let n=g(e.time),t=n+e.duration;return s>=n&&s<t||r>n&&r<=t||s<=n&&r>=t})},A=async e=>{if(!e)return b([]),[];console.log("\uD83D\uDD27 SCHRITT 3: Generiere erweiterte Zeitslots mit Verf\xfcgbarkeitsstatus...");try{let n=F(e),s=await (0,c.c8)(n);console.log(`ðŸ“… ${s.length} Buchungen gefunden f\xfcr ${n}`);let r=[];try{let{getBlockedTimesForDate:e}=await Promise.resolve().then(t.bind(t,4293));r=await e(n),console.log(`ðŸš« ${r.length} Admin-Sperrungen gefunden f\xfcr ${n}`)}catch(e){console.warn("\uD83D\uDD27 FALLBACK: Konnte gesperrte Zeiten nicht laden:",e.message)}let i=u(),a=[];for(let e of i){let n=g(e),t=n+T;if(t>1080)continue;let i=!0,l="";if(s.some(e=>{if(!e.time||"number"!=typeof e.duration)return!1;let s=g(e.time),r=s+e.duration;return n>=s&&n<r||t>s&&t<=r||n<=s&&t>=r})&&(i=!1,l="Bereits gebucht"),i&&r.length>0){let e=r.find(e=>{if(e.isFullDay)return!0;if(!e.startTime||!e.endTime)return!1;let t=g(e.startTime),s=g(e.endTime);return n>=t&&n<s});e&&(i=!1,l=e.isFullDay?`Ganzer Tag gesperrt: ${e.reason}`:`Gesperrt: ${e.reason}`)}a.push({time:e,isAvailable:i,reason:l})}let l=a.filter(e=>e.isAvailable).length,o=a.filter(e=>!e.isAvailable).length;return console.log(`âœ… SCHRITT 3: ${l} verf\xfcgbare + ${o} nicht verf\xfcgbare Zeitslots generiert`),b(a),a.filter(e=>e.isAvailable).map(e=>e.time)}catch(e){return console.error("Fehler beim Generieren der erweiterten Zeitslots:",e),b([]),[]}},I=async e=>{if(!e)return[];N(!0);try{let n=F(e);console.log(`DateTimeSelection: Lade Zeitslots f\xfcr ${n}`),console.log("\uD83D\uDD27 SCHRITT 2: Verwende getAvailableTimeSlots mit Fallback...");try{let n=await h(e,T);if(0===n.length)throw console.log("âš ï¸ WARNUNG: getAvailableTimeSlots gab 0 Slots zur\xfcck - verwende Fallback"),Error("Fallback aktiviert");return console.log(`âœ… SCHRITT 2: ${n.length} verf\xfcgbare Zeitslots gefunden (MIT Admin-Sperrungen)`),await A(e),n}catch(r){console.warn("\uD83D\uDD27 FALLBACK: getAvailableTimeSlots fehlgeschlagen, verwende vereinfachte Version:",r.message);let t=await (0,c.c8)(n);console.log(`ðŸ”§ FALLBACK: ${t.length} Buchungen gefunden`);let s=u().filter(e=>{let n=g(e),s=n+T;return!(s>1080)&&!t.some(e=>{if(!e.time||"number"!=typeof e.duration)return!1;let t=g(e.time),r=t+e.duration;return n>=t&&n<r||s>t&&s<=r||n<=t&&s>=r})});return console.log(`ðŸ”§ FALLBACK: ${s.length} verf\xfcgbare Zeitslots gefunden (OHNE Admin-Sperrungen)`),await A(e),s}}catch(e){return console.error("Fehler beim Laden der Zeitslots:",e),[]}finally{N(!1)}},C=async e=>{console.log("Neues Datum ausgew\xe4hlt:",e);let n=new Date(e);n.setHours(0,0,0,0),s(e=>({...e,date:n,time:null})),console.log("\uD83D\uDD27 DEBUG: Laden der gesperrten Zeiten \xfcbersprungen f\xfcr Debugging...")},E=async e=>{if(console.log("Zeit ausgew\xe4hlt:",e,"f\xfcr Datum:",n.date),n.date){let r=F(n.date);console.log("Pr\xfcfe Verf\xfcgbarkeit f\xfcr:",r,e),console.log("\uD83D\uDD27 SCHRITT 2: Pr\xfcfe Admin-Sperrungen bei Zeitauswahl...");try{let{isTimeSlotBlocked:n}=await Promise.resolve().then(t.bind(t,4293));if(await n(r,e)){console.log(`ðŸš« SCHRITT 2: Zeitslot ${e} ist vom Admin gesperrt`),w(`Der gew\xe4hlte Zeitslot ist nicht verf\xfcgbar (administrativ gesperrt). Bitte w\xe4hlen Sie eine andere Zeit.`);return}console.log(`âœ… SCHRITT 2: Zeitslot ${e} ist NICHT gesperrt`)}catch(e){console.warn("\uD83D\uDD27 FALLBACK: Admin-Sperrung-Pr\xfcfung fehlgeschlagen, erlaube Zeitslot:",e.message)}if($(e,await (0,c.c8)(r),T)){let t=await I(n.date),s=t.findIndex(n=>g(n)>g(e)),r=-1!==s?t[s]:null;r?w(`Der gew\xe4hlte Zeitslot ist bereits belegt. Der n\xe4chste verf\xfcgbare Termin ist um ${r} Uhr.`):w(`Der gew\xe4hlte Zeitslot ist bereits belegt. Es gibt keine weiteren verf\xfcgbaren Zeitslots f\xfcr diesen Tag.`);return}let i={date:n.date,time:e};console.log("Setze neuen Termin:",i),s(i),w(null)}else console.error("Kein Datum ausgew\xe4hlt, kann Zeit nicht setzen"),w("Bitte w\xe4hlen Sie zuerst ein Datum aus.")},L=(()=>{let e=f.getFullYear(),t=f.getMonth(),s=new Date(e,t,1).getDay()-1;-1===s&&(s=6);let r=new Date(e,t+1,0).getDate(),i=[];for(let e=0;e<s;e++)i.push({day:null,date:null});let a=new Date;a.setHours(0,0,0,0);for(let s=1;s<=r;s++){let r=new Date(e,t,s),l=0===r.getDay(),o=r.toISOString().split("T")[0],c=k.find(e=>e.date===o&&!0===e.isFullDay),d=!!c;d&&console.log(`ðŸ”§ SCHRITT 1: Tag ${o} ist vollst\xe4ndig gesperrt:`,c?.reason);let m=r<a,u=!l&&!m&&!d,g=n.date&&r.getDate()===n.date.getDate()&&r.getMonth()===n.date.getMonth()&&r.getFullYear()===n.date.getFullYear();i.push({day:s,date:r,isAvailable:u,isPast:m,isSelected:g,isSunday:l,isBlockedByAdmin:d,blockedReason:c?.reason||null})}return i})(),M=null!==n.date&&null!==n.time,P=`${["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][f.getMonth()]} ${f.getFullYear()}`;return(0,r.jsxs)("div",{className:"datetime-selection-container",children:[r.jsx("h3",{className:"heading-tertiary",children:"Termindaten"}),(0,r.jsxs)("p",{className:"booking-step-description",children:["Bitte w\xe4hlen Sie ein Datum und eine Uhrzeit f\xfcr Ihre Behandlung.",T>0&&(0,r.jsxs)("span",{className:"total-duration",children:[" ","Gesamtdauer: ",T," Minuten"]})]}),(0,r.jsxs)("div",{className:"calendar-container",children:[(0,r.jsxs)("div",{className:"calendar-header",children:[r.jsx("button",{type:"button",onClick:()=>{let e=new Date(f);e.setMonth(e.getMonth()-1);let n=new Date;e.getFullYear()<n.getFullYear()||e.getFullYear()===n.getFullYear()&&e.getMonth()<n.getMonth()||j(e)},className:"month-nav-btn","aria-label":"Vorheriger Monat",children:"<"}),r.jsx("h4",{className:"current-month",children:P}),r.jsx("button",{type:"button",onClick:()=>{let e=new Date(f);e.setMonth(e.getMonth()+1),j(e)},className:"month-nav-btn","aria-label":"N\xe4chster Monat",children:">"})]}),(0,r.jsxs)("div",{className:"calendar-weekdays",children:[r.jsx("div",{className:"weekday",children:"Mo"}),r.jsx("div",{className:"weekday",children:"Di"}),r.jsx("div",{className:"weekday",children:"Mi"}),r.jsx("div",{className:"weekday",children:"Do"}),r.jsx("div",{className:"weekday",children:"Fr"}),r.jsx("div",{className:"weekday",children:"Sa"}),r.jsx("div",{className:"weekday",children:"So"})]}),r.jsx("div",{className:"calendar-days",children:L.map((e,n)=>(0,r.jsxs)("div",{className:`calendar-day ${e.day?"":"empty-day"} ${e.isSunday?"sunday":""} ${e.isPast?"past-day":""} ${e.isBlockedByAdmin?"blocked-day":""} ${e.isAvailable?"available-day":""} ${e.isSelected?"selected-day":""}`,onClick:()=>{e.day&&e.isAvailable&&C(e.date)},title:e.isBlockedByAdmin?`ðŸš« Nicht verf\xfcgbar: ${e.blockedReason}`:e.isSunday?"âŒ Sonntags geschlossen":e.isPast?"âŒ Datum liegt in der Vergangenheit":"",children:[e.day,e.isBlockedByAdmin&&(0,r.jsxs)("div",{className:"blocked-tooltip",children:[r.jsx("strong",{children:"\uD83D\uDEAB Nicht verf\xfcgbar"}),r.jsx("br",{}),e.blockedReason]})]},n))}),(0,r.jsxs)("div",{className:"calendar-legend",children:[(0,r.jsxs)("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-indicator available"}),r.jsx("span",{children:"Verf\xfcgbar"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-indicator sunday"}),r.jsx("span",{children:"Sonntags geschlossen"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-indicator past"}),r.jsx("span",{children:"Vergangen"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-indicator blocked"}),r.jsx("span",{children:"Gesperrt"})]}),D&&r.jsx("div",{className:"legend-loading",children:r.jsx("span",{children:"â³ Lade Sperrungen..."})})]})]}),n.date&&(0,r.jsxs)("div",{className:"time-slots-container",children:[r.jsx("h4",{className:"time-slots-heading",children:"Verf\xfcgbare Zeiten"}),v?r.jsx("p",{className:"loading-message",children:"Lade verf\xfcgbare Zeiten..."}):(0,r.jsxs)(r.Fragment,{children:[y&&r.jsx("p",{className:"unavailable-message",children:y}),r.jsx("div",{className:"time-slots-grid",children:p.length>0?p.map((e,t)=>(0,r.jsxs)("button",{type:"button",className:`time-slot ${n.time===e.time?"selected-time":""} ${e.isAvailable?"":"unavailable-time"}`,onClick:()=>e.isAvailable&&E(e.time),disabled:!e.isAvailable,title:e.isAvailable?`Verf\xfcgbar um ${e.time}`:`Nicht verf\xfcgbar: ${e.reason}`,children:[e.time,!e.isAvailable&&r.jsx("span",{className:"unavailable-icon",children:"\uD83D\uDEAB"})]},t)):!y&&r.jsx("p",{className:"no-slots-message",children:"Keine Zeiten f\xfcr dieses Datum verf\xfcgbar."})}),p.length>0&&(0,r.jsxs)("div",{className:"time-slots-legend",children:[(0,r.jsxs)("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-indicator time-available"}),r.jsx("span",{children:"Verf\xfcgbar"})]}),(0,r.jsxs)("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-indicator time-unavailable",children:r.jsx("span",{className:"mini-icon",children:"\uD83D\uDEAB"})}),r.jsx("span",{children:"Nicht verf\xfcgbar"})]})]})]})]}),(0,r.jsxs)("div",{className:"form-actions",children:[r.jsx("button",{type:"button",onClick:a,className:"btn btn-secondary",children:"Zur\xfcck"}),r.jsx("button",{type:"button",onClick:()=>{if(!n.date||!n.time){w("Bitte w\xe4hlen Sie ein Datum und eine Uhrzeit aus, bevor Sie fortfahren.");return}console.log("DateTimeSelection - Fortfahren mit:",n),l()},className:"btn btn-primary",disabled:!M,children:"Weiter"})]})]})}t(3805);var j=t(5920);t(4856);let v=(0,i.createContext)({user:null,loading:!0,customerData:null}),N=()=>(0,i.useContext)(v);var y=t(4419);function w({totalPrice:e,onDiscountCalculated:n,showProgress:t=!0,currentTreatments:s=[]}){let[a,l]=(0,i.useState)(null),[o,c]=(0,i.useState)(!0),[d,m]=(0,i.useState)(null);if(!d)return r.jsx("div",{className:"discount-guest-info",children:(0,r.jsxs)("div",{className:"discount-card discount-info",children:[r.jsx("div",{className:"discount-icon",children:r.jsx("ion-icon",{name:"person-outline"})}),(0,r.jsxs)("div",{className:"discount-content",children:[r.jsx("h4",{children:"Exklusive Rabatte f\xfcr Mitglieder"}),r.jsx("p",{children:"Melden Sie sich an, um von Treue- und Geburtstagsrabatten zu profitieren!"})]})]})});if(o)return r.jsx("div",{className:"discount-loading",children:(0,r.jsxs)("div",{className:"discount-card",children:[r.jsx("div",{className:"discount-spinner"}),r.jsx("p",{children:"Rabatte werden berechnet..."})]})});if(!a)return null;let u=e-a.amount;return r.jsx("div",{className:"discount-display",children:a.isEligible?(0,r.jsxs)("div",{className:"discount-card discount-active",children:[(0,r.jsxs)("div",{className:"discount-header",children:[r.jsx("div",{className:"discount-icon discount-icon-active",children:"loyalty"===a.type?r.jsx("ion-icon",{name:"star"}):r.jsx("ion-icon",{name:"gift"})}),(0,r.jsxs)("div",{className:"discount-badge",children:["-",a.percentage,"%"]})]}),(0,r.jsxs)("div",{className:"discount-content",children:[r.jsx("h4",{className:"discount-title",children:"loyalty"===a.type?"\uD83C\uDF89 Treuerabatt":"\uD83C\uDF82 Geburtstagsrabatt"}),r.jsx("p",{className:"discount-description",children:a.description}),(0,r.jsxs)("div",{className:"discount-calculation",children:[(0,r.jsxs)("div",{className:"price-row original-price",children:[r.jsx("span",{children:"Originalpreis:"}),(0,r.jsxs)("span",{children:["â‚¬",e.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"price-row discount-amount",children:[(0,r.jsxs)("span",{children:["Rabatt (",a.percentage,"%):"]}),(0,r.jsxs)("span",{children:["-â‚¬",a.amount.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"price-row final-price",children:[r.jsx("span",{children:"Endpreis:"}),(0,r.jsxs)("span",{children:["â‚¬",u.toFixed(2)]})]})]}),(0,r.jsxs)("div",{className:"discount-savings",children:["Sie sparen â‚¬",a.amount.toFixed(2),"!"]})]})]}):t&&a.progressInfo&&(0,r.jsxs)("div",{className:"discount-card discount-progress",children:[r.jsx("div",{className:"discount-icon",children:r.jsx("ion-icon",{name:"star-outline"})}),(0,r.jsxs)("div",{className:"discount-content",children:[r.jsx("h4",{className:"discount-title",children:"Treuerabatt-Fortschritt"}),r.jsx("p",{className:"discount-description",children:a.description}),(0,r.jsxs)("div",{className:"progress-container",children:[r.jsx("div",{className:"progress-bar",children:r.jsx("div",{className:"progress-fill",style:{width:`${a.progressInfo.current/a.progressInfo.required*100}%`}})}),(0,r.jsxs)("div",{className:"progress-text",children:[a.progressInfo.current," /"," ",a.progressInfo.required," Behandlungen"]})]}),(0,r.jsxs)("div",{className:"progress-motivation",children:["Noch ",a.progressInfo.remaining," Behandlungen bis zu 20% Rabatt!"]})]})]})})}let k=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e);function S({selectedTreatments:e,selectedDateTime:n,customerInfo:t,onBack:s,onConfirm:a,error:l}){let[o,c]=(0,i.useState)(!1),[d,m]=(0,i.useState)(null),[u,g]=(0,i.useState)(null),[h,x]=(0,i.useState)(0),{user:p}=N(),b=e.reduce((e,n)=>e+n.price,0),f=e.reduce((e,n)=>e+n.duration,0);return(0,r.jsxs)("div",{className:"booking-summary bg-white rounded-lg shadow-md border border-gray-100",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h3",{className:"text-2xl font-semibold text-gray-800",children:"Buchungs\xfcbersicht"})}),e.length>0?r.jsx("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"grid gap-8",children:[(0,r.jsxs)("div",{className:"booking-section",children:[(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"}),r.jsx("line",{x1:"16",y1:"8",x2:"2",y2:"22"}),r.jsx("line",{x1:"17.5",y1:"15",x2:"9",y2:"15"})]}),"Ausgew\xe4hlte Behandlungen"]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-5",children:r.jsx("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,r.jsxs)("li",{className:"py-4 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-lg font-medium text-gray-800",children:e.name}),(0,r.jsxs)("span",{className:"text-base text-gray-500 flex items-center gap-1 mt-1",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.duration," Min."]})]}),r.jsx("span",{className:"text-lg font-semibold text-gray-800",children:k(e.price)})]},e.id))})})]}),n&&(0,r.jsxs)("div",{className:"booking-section",children:[(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),r.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),r.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Termin"]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),r.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),r.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-base text-gray-500",children:"Datum"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:(e=>{if(!e)return"Kein Datum gew\xe4hlt";try{let n;if(n=e instanceof Date?e:new Date(e),isNaN(n.getTime()))return"Ung\xfcltiges Datum";return n.toLocaleDateString("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch(e){return console.error("Fehler beim Formatieren des Datums:",e),"Ung\xfcltiges Datum"}})(n.date)||"Kein Datum gew\xe4hlt"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-base text-gray-500",children:"Uhrzeit"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:n.time&&""!==n.time?`${n.time} Uhr`:"Keine Uhrzeit gew\xe4hlt"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-base text-gray-500",children:"Gesamtdauer"}),(0,r.jsxs)("p",{className:"text-lg font-medium text-gray-800",children:[f," Minuten"]})]})]})]})})]}),t&&(0,r.jsxs)("div",{className:"booking-section",children:[(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),r.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),"Ihre Daten"]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-base text-gray-500",children:"Name"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:(()=>{if(!t)return"Kein Kunde angegeben";if(t.firstName&&t.lastName){let e=t.firstName.trim(),n=t.lastName.trim();return`${e} ${n}`}if(t.firstName||t.lastName)return(t.firstName||t.lastName||"").trim();if("fullName"in t&&t.fullName){let e=t.fullName.trim();return""!==e?e:"Kein Name angegeben"}if("name"in t&&t.name){let e=t.name.trim();return""!==e?e:"Kein Name angegeben"}return t.email&&t.email.includes("@")?t.email.split("@")[0]:"Kein Name angegeben"})()||"Kein Name angegeben"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-base text-gray-500",children:"E-Mail"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:t.email&&""!==t.email.trim()?t.email:"Keine E-Mail angegeben"})]}),(t.phone||"phoneNumber"in t&&t.phoneNumber)&&(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-base text-gray-500",children:"Telefon"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:t.phone||("phoneNumber"in t?t.phoneNumber:"Keine Telefonnummer")})]})]})})]}),r.jsx(w,{totalPrice:b,onDiscountCalculated:e=>{g(e),x(b-e.amount)},showProgress:!0,currentTreatments:e}),(0,r.jsxs)("div",{className:"booking-section",children:[(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 mb-4 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),r.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Preis\xfcbersicht"]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-5",children:(0,r.jsxs)("div",{className:"divide-y divide-gray-200",children:[(0,r.jsxs)("div",{className:"price-row py-3 flex justify-between text-lg",children:[r.jsx("span",{children:"Grundpreis:"}),r.jsx("span",{className:"font-medium",children:k(b)})]}),u&&u.isEligible&&(0,r.jsxs)("div",{className:"price-row py-3 flex justify-between text-lg text-green-600",children:[(0,r.jsxs)("span",{children:["loyalty"===u.type?"Treuerabatt":"Geburtstagsrabatt","(",u.percentage,"%):"]}),(0,r.jsxs)("span",{className:"font-medium",children:["-",k(u.amount)]})]}),(0,r.jsxs)("div",{className:"total-price-row py-4 flex justify-between items-center",children:[r.jsx("span",{className:"font-semibold text-xl",children:"Gesamt:"}),r.jsx("span",{className:"font-bold text-2xl text-[#28a745]",children:k(h)})]}),u&&u.isEligible&&u.amount>0&&r.jsx("div",{className:"savings-highlight py-3",children:r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M20 12v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6"}),r.jsx("polyline",{points:"9 17 12 14 15 17"}),r.jsx("polyline",{points:"15 7 12 10 9 7"})]}),(0,r.jsxs)("span",{className:"font-semibold",children:["Sie sparen ",k(u.amount),"!"]})]})})}),(0,r.jsxs)("div",{className:"price-details py-4",children:[(0,r.jsxs)("p",{className:"text-base text-gray-500",children:["Enthaltene MwSt (19%):"," ",k(.19*h/1.19)]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-base text-gray-500",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),(0,r.jsxs)("span",{children:["Gesamtdauer: ",f," Min."]})]})]})]})})]}),(0,r.jsxs)("div",{className:"booking-actions mt-6 flex flex-col sm:flex-row gap-4",children:[r.jsx("button",{type:"button",onClick:s,className:"py-4 px-6 text-lg rounded-md border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 transition-colors flex-1",children:"Zur\xfcck"}),r.jsx("button",{type:"button",onClick:()=>{let s={treatments:e,dateTime:n,customer:t,discountInfo:u,originalPrice:b,finalPrice:h,appliedDiscount:u?.isEligible?u:null};try{sessionStorage.setItem("bookingTreatments",JSON.stringify(e)),sessionStorage.setItem("bookingDataWithDiscount",JSON.stringify(s)),u?.isEligible&&(sessionStorage.setItem("appliedDiscount",JSON.stringify(u)),sessionStorage.setItem("originalPrice",b.toString()),sessionStorage.setItem("finalPrice",h.toString())),window.__BOOKING_TREATMENTS__=e,window.__BOOKING_DISCOUNT_DATA__=s,localStorage.setItem("bookingTreatments",JSON.stringify(e)),localStorage.setItem("bookingDataWithDiscount",JSON.stringify(s)),console.log("\uD83D\uDCBE Buchungsdaten mit Rabatt gespeichert:",{treatments:e.length,originalPrice:b,finalPrice:h,discount:u?.isEligible?`${u.percentage}%`:"Kein Rabatt",savings:u?.amount||0})}catch(e){console.error("Fehler beim Speichern der Buchungsdaten:",e)}console.log("âœ… Best\xe4tigung mit kompletten Buchungsdaten:",s);try{a(e)}catch(e){a()}},className:"py-4 px-6 text-lg rounded-md bg-[#b2d8db] text-gray-800 font-medium hover:bg-[#9ecacd] transition-colors flex-1",children:"Termin verbindlich buchen"})]})]})}):(0,r.jsxs)("div",{className:"p-10 text-center",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 mx-auto text-gray-300 mb-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),r.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),r.jsx("p",{className:"text-xl text-gray-500 mb-6",children:"Sie haben noch keine Behandlungen ausgew\xe4hlt."}),r.jsx("button",{onClick:s,className:"py-4 px-8 text-lg rounded-md bg-[#b2d8db] text-gray-800 font-medium hover:bg-[#9ecacd] transition-colors",children:"Zur\xfcck zur Behandlungsauswahl"})]}),l&&r.jsx("div",{className:"p-5 bg-red-50 text-red-600 border-t border-red-200 rounded-b-lg text-lg",children:l})]})}var D=t(5047);function B({selectedTreatments:e,selectedDateTime:n,customerInfo:t}){let s=(0,D.useRouter)(),[l,o]=(0,i.useState)(null),[c,d]=(0,i.useState)(0),[m,u]=(0,i.useState)(0);console.log("BookingConfirmation geladen - ID:",e[0]?.id||"N/A");let g=e.reduce((e,n)=>e+n.duration,0),h=e.map(e=>{let n=(0,p.jE)(e.price);return{...e,priceComponents:n}}),x=(0,p.jE)(c);(0,p.jE)(m);let b=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),f=`SHN-${Math.floor(1e4*Math.random())}-${new Date().getFullYear()}`;return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-[#e8f3f4] p-8 text-center",children:[r.jsx("div",{className:"mx-auto w-16 h-16 bg-[#b2d8db] rounded-full flex items-center justify-center mb-4 shadow-md",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),r.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Buchung erfolgreich!"}),(0,r.jsxs)("p",{className:"text-lg text-gray-600",children:["Vielen Dank f\xfcr Ihre Buchung, ",t.fullName,"! Eine Best\xe4tigungsmail wurde an"," ",r.jsx("span",{className:"font-medium",children:t.email})," gesendet."]})]}),(0,r.jsxs)("div",{className:"p-6 md:p-8",children:[(0,r.jsxs)("div",{className:"mb-8 flex justify-between items-center",children:[r.jsx("h3",{className:"text-2xl font-semibold text-gray-800",children:"Ihre Buchungsdetails"}),r.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:(0,r.jsxs)("p",{className:"text-base font-medium",children:["Buchungsnummer:"," ",r.jsx("span",{className:"text-[#28a745] font-bold",children:f})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[r.jsx("div",{className:"md:col-span-2",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"}),r.jsx("line",{x1:"16",y1:"8",x2:"2",y2:"22"}),r.jsx("line",{x1:"17.5",y1:"15",x2:"9",y2:"15"})]}),"Gebuchte Behandlungen"]})}),r.jsx("div",{className:"p-4",children:r.jsx("ul",{className:"divide-y divide-gray-200",children:h.map(e=>r.jsx("li",{className:"py-4 first:pt-2 last:pb-2",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-lg font-medium text-gray-800",children:e.name}),r.jsx("span",{className:"text-lg font-semibold text-gray-800",children:(0,p.T4)(e.price)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-gray-500",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),(0,r.jsxs)("span",{children:[e.duration," Min."]})]})]})},e.id))})})]})}),r.jsx("div",{className:"md:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden h-full",children:[r.jsx("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),r.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),r.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),"Termin"]})}),r.jsx("div",{className:"p-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Datum"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:(e=>{if(!e)return"Kein Datum gew\xe4hlt";try{let n;if(n=e instanceof Date?e:new Date(e),isNaN(n.getTime()))return"Ung\xfcltiges Datum";return new Intl.DateTimeFormat("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(n)}catch(e){return console.error("Fehler beim Formatieren des Datums:",e),"Ung\xfcltiges Datum"}})(n.date)})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Uhrzeit"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:n.time?n.time+" Uhr":"Keine Uhrzeit gew\xe4hlt"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Gesamtdauer"}),(0,r.jsxs)("p",{className:"text-lg font-medium text-gray-800",children:[g," Minuten"]})]})]})})]})})]}),r.jsx("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),r.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),"Ihre Daten"]})}),r.jsx("div",{className:"p-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Name"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:t.fullName||"Kein Name angegeben"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-500",children:"E-Mail"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:t.email||"Keine E-Mail angegeben"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Telefon"}),r.jsx("p",{className:"text-lg font-medium text-gray-800",children:t.phone||"Keine Telefonnummer angegeben"})]}),t.message&&(0,r.jsxs)("div",{className:"col-span-full mt-2",children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Ihre Nachricht"}),r.jsx("p",{className:"text-base",children:t.message})]})]})})]})}),r.jsx("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[r.jsx("div",{className:"py-3 px-4 bg-[#f8f9fa] border-b border-gray-200",children:(0,r.jsxs)("h4",{className:"text-xl font-medium text-gray-700 flex items-center gap-2",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),r.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),"Preis\xfcbersicht"]})}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"divide-y divide-gray-200",children:[(0,r.jsxs)("div",{className:"py-3 flex justify-between text-lg",children:[r.jsx("span",{children:"Grundpreis:"}),r.jsx("span",{className:"font-medium",children:b(m)})]}),l?.appliedDiscount?.isEligible&&(0,r.jsxs)("div",{className:"py-3 flex justify-between text-lg text-green-600",children:[(0,r.jsxs)("span",{children:["loyalty"===l.appliedDiscount.type?"Treuerabatt":"Geburtstagsrabatt","(",l.appliedDiscount.percentage,"%):"]}),(0,r.jsxs)("span",{className:"font-medium",children:["-",b(l.appliedDiscount.amount)]})]}),(0,r.jsxs)("div",{className:"py-4 flex justify-between items-center",children:[r.jsx("span",{className:"font-semibold text-xl",children:"Gesamt:"}),r.jsx("span",{className:"font-bold text-2xl text-[#28a745]",children:b(c)})]}),l?.appliedDiscount?.isEligible&&l.appliedDiscount.amount>0&&r.jsx("div",{className:"py-3",children:r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M20 12v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6"}),r.jsx("polyline",{points:"9 17 12 14 15 17"}),r.jsx("polyline",{points:"15 7 12 10 9 7"})]}),(0,r.jsxs)("span",{className:"font-semibold",children:["Sie haben"," ",b(l.appliedDiscount.amount)," ","gespart!"]})]})})})]}),(0,r.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("p",{className:"flex justify-between text-base text-gray-600",children:[r.jsx("span",{children:"Netto-Gesamt:"}),r.jsx("span",{children:x.netFormatted})]}),(0,r.jsxs)("p",{className:"flex justify-between text-base text-gray-600 mt-2",children:[r.jsx("span",{children:"MwSt (19%):"}),r.jsx("span",{children:x.vatFormatted})]}),(0,r.jsxs)("div",{className:"pt-3 mt-3 border-t border-gray-200 flex justify-between items-center",children:[r.jsx("span",{className:"font-semibold text-xl",children:"Gesamtbetrag:"}),r.jsx("span",{className:"font-bold text-2xl text-[#28a745]",children:x.grossFormatted})]})]})]})]})}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mt-6",children:[r.jsx(a.default,{href:"/",className:"py-4 px-6 rounded-md bg-white border border-gray-300 text-gray-700 text-lg font-medium hover:bg-gray-50 transition-colors text-center flex-1",children:"Zur\xfcck zur Startseite"}),r.jsx("button",{onClick:()=>{console.log("\uD83D\uDD04 Starte neue Buchung...");try{localStorage.removeItem("bookingTreatments"),sessionStorage.removeItem("bookingTreatments"),sessionStorage.removeItem("bookingDataWithDiscount"),sessionStorage.removeItem("appliedDiscount"),sessionStorage.removeItem("originalPrice"),sessionStorage.removeItem("finalPrice"),localStorage.removeItem("bookingDataWithDiscount"),console.log("âœ… Buchungsdaten gel\xf6scht")}catch(e){console.error("âŒ Fehler beim L\xf6schen der Buchungsdaten:",e)}let e="/booking?step=treatments&refresh="+Date.now();console.log("\uD83D\uDE80 Navigiere zu:",e);try{s.push(e),console.log("âœ… Router.push ausgef\xfchrt"),setTimeout(()=>{console.log("\uD83D\uDD04 Fallback: Verwende window.location"),window.location.href=e},100)}catch(n){console.error("âŒ Router.push fehlgeschlagen, verwende window.location:",n),window.location.href=e}},className:"py-4 px-6 rounded-md bg-[#b2d8db] text-gray-800 text-lg font-medium hover:bg-[#9ecacd] transition-colors text-center flex-1",children:"Weitere Behandlung buchen"})]})]})]})}let T={pmu:`
    <h4>Permanent Make-up â€“ PMU (Augenbrauen, Lippen, Eyeliner)</h4>
    <p><strong>Nicht geeignet f\xfcr:</strong></p>
    <ul>
      <li>Schwangere oder stillende Personen</li>
      <li>Personen mit aktiven Hautkrankheiten im Behandlungsbereich</li>
      <li>Personen mit Blutgerinnungsst\xf6rungen oder Einnahme blutverd\xfcnnender Medikamente</li>
    </ul>
    <p><strong>24 Stunden vor der Behandlung:</strong></p>
    <ul>
      <li>Kein Kaffee, Alkohol oder blutverd\xfcnnende Medikamente (z. B. Aspirin) einnehmen.</li>
    </ul>
    <p><strong>7 Tage vor der Behandlung:</strong></p>
    <ul>
      <li>Keine Botox- oder Filler-Behandlungen im Behandlungsbereich.</li>
    </ul>
    <p><strong>Bei Lippen-PMU:</strong></p>
    <ul>
      <li>Falls Sie zu Herpes neigen, empfehlen wir eine Prophylaxe vor der Behandlung.</li>
      <li>Falls Ihre Lippen trocken sind, f\xfchren Sie bitte 1â€“2 Tage vor der Behandlung ein sanftes Peeling durch und verwenden Sie eine feuchtigkeitsspendende Lippenpflege.</li>
    </ul>
    <p><strong>Wichtiger Hinweis:</strong></p>
    <ul>
      <li>Die behandelte Stelle darf f\xfcr 48 Stunden nicht mit Wasser in Kontakt kommen. Bitte planen Sie Ihre Haarw\xe4sche oder Dusche entsprechend im Voraus.</li>
    </ul>
  `,"lash-lifting":`
    <h4>Lash Lifting â€“ Wimpernlifting</h4>
    <ul>
      <li>Bitte kommen Sie ungeschminkt zur Behandlung.</li>
      <li>Hormonelle Schwankungen (z. B. Periode, Schwangerschaft, Stillzeit) k\xf6nnen das Ergebnis beeinflussen.</li>
      <li>Verwenden Sie 24 Stunden vor der Behandlung keine \xf6lhaltigen Produkte auf den Wimpern.</li>
      <li>Falls Sie empfindliche Augen oder Allergien haben, teilen Sie uns dies bitte im Voraus mit.</li>
      <li>Tragen Sie keine Kontaktlinsen w\xe4hrend der Behandlung. Bitte entfernen Sie Ihre Linsen vorher oder bringen Sie Ihr Etui und Pflegemittel mit.</li>
    </ul>
  `,browlifting:`
    <h4>Brow Lifting â€“ Augenbrauenlifting</h4>
    <ul>
      <li>Bitte kommen Sie ohne Make-up an den Augenbrauen.</li>
      <li>Die Haut sollte frei von Irritationen, Wunden oder Sonnenbrand sein.</li>
      <li>Hormonelle Ver\xe4nderungen k\xf6nnen das Ergebnis beeinflussen.</li>
      <li>48 Stunden vor der Behandlung kein Peeling oder starkes Reiben der Brauenhaut.</li>
    </ul>
  `,microneedling:`
    <h4>Microneedling</h4>
    <p><strong>Nicht geeignet f\xfcr:</strong></p>
    <ul>
      <li>Schwangere oder stillende Personen</li>
      <li>Personen mit aktiven Hautinfektionen, Ekzemen oder offenen Wunden im Behandlungsbereich</li>
      <li>Personen mit Blutgerinnungsst\xf6rungen oder Einnahme blutverd\xfcnnender Medikamente</li>
      <li>Personen mit Neigung zu Keloiden oder hypertrophen Narben</li>
    </ul>
    <p><strong>7 Tage vor der Behandlung:</strong></p>
    <ul>
      <li>Keine Botox-, Filler- oder chemische Peeling-Behandlungen.</li>
    </ul>
    <p><strong>24 Stunden vor der Behandlung:</strong></p>
    <ul>
      <li>Kein Alkohol, Koffein oder blutverd\xfcnnende Medikamente (z. B. Aspirin) einnehmen.</li>
      <li>Kein intensives Sonnenbaden oder Solarium.</li>
    </ul>
    <p><strong>Wichtiger Hinweis:</strong></p>
    <ul>
      <li>Bitte kommen Sie mit gereinigter Haut und ohne Make-up zur Behandlung.</li>
      <li>Nach der Behandlung kann die Haut leicht ger\xf6tet sein â€“ dies ist normal und klingt in der Regel innerhalb von 24â€“48 Stunden ab.</li>
      <li>Planen Sie Ihre Termine so, dass Sie nach der Behandlung mindestens 48 Stunden lang kein Make-up auftragen m\xfcssen.</li>
    </ul>
  `,default:`
    <h4>Behandlungsinformationen</h4>
    <p>F\xfcr diese Behandlung gibt es keine speziellen Vorbereitungen oder Einschr\xe4nkungen.</p>
    <p>F\xfcr ein optimales Ergebnis empfehlen wir jedoch:</p>
    <ul>
      <li>Kommen Sie entspannt und ausgeruht zur Behandlung</li>
      <li>Trinken Sie ausreichend Wasser vor Ihrem Termin</li>
      <li>Informieren Sie uns \xfcber eventuelle Allergien oder Hautempfindlichkeiten</li>
    </ul>
    <p>Bei Fragen oder Unsicherheiten kontaktieren Sie uns gerne vor Ihrem Termin unter: <strong>kontakt@sheenberlin.de</strong></p>
  `};function F({selectedTreatments:e,onBack:n,onContinue:t}){let[s,a]=(0,i.useState)(!1);return(0,r.jsxs)("div",{className:"treatment-terms-container",children:[r.jsx("h3",{className:"heading-tertiary",children:"Behandlungsbedingungen"}),r.jsx("p",{className:"booking-step-description",children:"Bitte lesen und best\xe4tigen Sie die folgenden Informationen zu Ihren gew\xe4hlten Behandlungen:"}),r.jsx("div",{className:"terms-content",dangerouslySetInnerHTML:{__html:(()=>{if(!e||0===e.length)return T.default;let n=new Set,t=new Set;return(e.forEach(e=>{let s="",r=e.id;!t.has(r)&&("microblading"===r||"lipblush"===r||"eyeliner"===r?t.has("pmu")||(s=T.pmu,t.add("pmu")):"lash-lifting"===r?t.has("lash-lifting")||(s=T["lash-lifting"],t.add("lash-lifting")):"browlifting"===r?t.has("browlifting")||(s=T.browlifting,t.add("browlifting")):"microneedling"===r?t.has("microneedling")||(s=T.microneedling,t.add("microneedling")):t.has("default")||(s=T.default,t.add("default")),s&&n.add(s))}),0===n.size)?T.default:Array.from(n).join('<hr class="terms-divider" />')})()}}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s&&t()},className:"terms-form",children:[(0,r.jsxs)("div",{className:"form-group checkbox-group",children:[r.jsx("input",{type:"checkbox",id:"accept-terms",checked:s,onChange:e=>a(e.target.checked),className:"form-checkbox"}),r.jsx("label",{htmlFor:"accept-terms",className:"checkbox-label",children:"Ich habe die Behandlungsbedingungen gelesen und verstanden *"})]}),!s&&r.jsx("p",{className:"terms-hint",children:"Bitte best\xe4tigen Sie die Behandlungsbedingungen, um fortzufahren."}),(0,r.jsxs)("div",{className:"form-actions",children:[r.jsx("button",{type:"button",onClick:n,className:"btn btn-secondary",children:"Zur\xfcck"}),r.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!s,children:"Weiter"})]})]})]})}function $(){return r.jsx("div",{className:"login-required-container",children:(0,r.jsxs)("div",{className:"login-required-content",children:[r.jsx("div",{className:"login-required-icon",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-24 w-24 text-[#b2d8db]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),r.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),r.jsx("h2",{className:"login-required-title",children:"Anmeldung erforderlich"}),r.jsx("p",{className:"login-required-text",children:"Um einen Termin zu buchen, m\xfcssen Sie sich zuerst anmelden. Nach der Anmeldung k\xf6nnen Sie Ihre Buchung fortsetzen."}),(0,r.jsxs)("div",{className:"login-required-buttons",children:[r.jsx(a.default,{href:"/login",className:"btn--primary",children:"Anmelden"}),r.jsx(a.default,{href:"/register",className:"btn--secondary",children:"Registrieren"})]})]})})}function A(){let[e,n]=(0,i.useState)([]),[s,o]=(0,i.useState)({date:null,time:null}),[d,m]=(0,i.useState)({fullName:"",email:"",phone:"",message:""}),[u,g]=(0,i.useState)(0),[h,x]=(0,i.useState)(!1),[p,v]=(0,i.useState)(null),[N,w]=(0,i.useState)(!1),[k,T]=(0,i.useState)(!1);(0,D.useRouter)();let A=e=>{n(n=>n.some(n=>n.id===e.id)?n.filter(n=>n.id!==e.id):[...n,e])},I=()=>{g(e=>e<5?e+1:e)},C=()=>{g(e=>e>0?e-1:e)},E=async()=>{try{if(T(!0),v(null),!e||0===e.length){v("Bitte w\xe4hlen Sie mindestens eine Behandlung aus."),T(!1);return}if(!s.date||!s.time){v("Bitte w\xe4hlen Sie ein Datum und eine Uhrzeit f\xfcr Ihren Termin."),T(!1);return}let n=e.reduce((e,n)=>e+n.price,0),r=e.reduce((e,n)=>e+n.duration,0),i=n,a=null,l=null;try{let e=sessionStorage.getItem("bookingDataWithDiscount"),t=sessionStorage.getItem("appliedDiscount"),s=sessionStorage.getItem("finalPrice");if(e){let t=JSON.parse(e);i=t.finalPrice||n,a=t.appliedDiscount,l=t.discountInfo,console.log("\uD83D\uDCCA Rabattdaten aus sessionStorage geladen:",{originalPrice:n,finalPrice:i,discount:a,savings:l?.amount||0})}else t&&s&&(a=JSON.parse(t),i=parseFloat(s),console.log("\uD83D\uDCCA Fallback-Rabattdaten geladen:",{originalPrice:n,finalPrice:i,discount:a}))}catch(e){console.error("Fehler beim Lesen der Rabattdaten:",e),i=n}let o=new Date(s.date);o.setHours(0,0,0,0);let m=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,u={name:d.fullName,email:d.email,phone:d.phone,date:m,time:s.time,service:e[0].id,serviceName:e[0].name,treatments:e,message:d.message||"",price:i,originalPrice:n,appliedDiscount:a,discountInfo:l,duration:r,termsAccepted:!0};if(a?.isEligible&&j.I8.currentUser?.uid){console.log("\uD83D\uDEA8 BLOCKIERE SOFORT weitere Rabatte f\xfcr diesen Benutzer!"),(0,y.DY)(j.I8.currentUser.uid);try{console.log("\uD83C\uDFAF WICHTIG: Setze Treuerabatt zur\xfcck VOR Buchungsbest\xe4tigung");let{updateDoc:e,doc:n,Timestamp:s}=await Promise.resolve().then(t.bind(t,76)),{db:r}=await Promise.resolve().then(t.bind(t,5920)),i=n(r,"users",j.I8.currentUser.uid);await e(i,{lastDiscountDate:s.now(),isEligibleForLoyaltyDiscount:!1,updatedAt:s.now()}),console.log("âœ… Treuerabatt-Reset VOR Buchung erfolgreich")}catch(e){console.error("âŒ Fehler beim Treuerabatt-Reset:",e)}}console.log("Buchungsdaten:",u);let h=await (0,c.km)(u);if(h.success){if(j.I8.currentUser?.uid&&!a?.isEligible)try{let n=e.length;console.log(`ðŸ”¢ Erh\xf6he Z\xe4hler um ${n} Behandlungen`),await (0,y.lk)(j.I8.currentUser.uid,n),console.log("âœ… Behandlungsz\xe4hler erfolgreich erh\xf6ht")}catch(e){console.error("âŒ Fehler beim Erh\xf6hen des Z\xe4hlers:",e)}if(a?.isEligible&&h.id)try{console.log("\uD83C\uDFAF Wende Rabatt an f\xfcr Buchung (Tracking):",h.id),await (0,y.tW)(j.I8.currentUser?.uid||"",h.id,a),console.log("âœ… Rabatt-Tracking erfolgreich angewendet")}catch(e){console.error("âŒ Fehler beim Rabatt-Tracking:",e)}h.error?(console.warn("Buchung mit Warnung erfolgreich:",h.error),v(h.error),x(!0),setTimeout(()=>{g(5)},3e3)):(x(!0),g(5))}else v(h.error||"Es ist ein Fehler aufgetreten. Bitte versuchen Sie es sp\xe4ter erneut."),T(!1)}catch(e){console.error("Fehler bei der Buchungsbest\xe4tigung:",e),e instanceof Error&&(e.toString().includes("permission-denied")||e.toString().includes("permission"))?(v("Die Buchung wurde erfolgreich gespeichert, aber es gab technische Probleme. Sie erhalten demn\xe4chst eine Best\xe4tigungs-E-Mail."),x(!0),setTimeout(()=>{g(5)},5e3)):(v(e instanceof Error?e.message:"Es ist ein unbekannter Fehler aufgetreten. Bitte versuchen Sie es sp\xe4ter erneut."),T(!1))}};return N?(0,r.jsxs)("section",{className:"section section-booking",children:[(0,r.jsxs)(a.default,{href:"/",className:"home-button",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),r.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Home"]}),r.jsx("div",{className:"container center-text",children:r.jsx("span",{className:"subheading",children:"Termin Buchen"})}),r.jsx("div",{className:"container",children:(0,r.jsxs)("div",{className:"booking-container",children:[r.jsx("div",{className:"booking-progress",children:r.jsx("div",{className:"progress-bar-container",children:(0,r.jsxs)("div",{className:"progress-steps",children:[r.jsx("div",{className:"progress-line"}),r.jsx("div",{className:"progress-line-active",style:{width:`${(u-1)/4*100}%`}}),(0,r.jsxs)("div",{className:`progress-step ${u>=0?"active":""} ${u>0?"completed":""}`,children:[r.jsx("div",{className:`step-circle ${u>=0?"active":""} ${u>0?"completed":""}`,children:u>0?"âœ“":"1"}),r.jsx("span",{className:"step-text",children:"Behandlung"})]}),(0,r.jsxs)("div",{className:`progress-step ${u>=1?"active":""} ${u>1?"completed":""}`,children:[r.jsx("div",{className:`step-circle ${u>=1?"active":""} ${u>1?"completed":""}`,children:u>1?"âœ“":"2"}),r.jsx("span",{className:"step-text",children:"Termin"})]}),(0,r.jsxs)("div",{className:`progress-step ${u>=2?"active":""} ${u>2?"completed":""}`,children:[r.jsx("div",{className:`step-circle ${u>=2?"active":""} ${u>2?"completed":""}`,children:u>2?"âœ“":"3"}),r.jsx("span",{className:"step-text",children:"Pers\xf6nliche Daten"})]}),(0,r.jsxs)("div",{className:`progress-step ${u>=3?"active":""} ${u>3?"completed":""}`,children:[r.jsx("div",{className:`step-circle ${u>=3?"active":""} ${u>3?"completed":""}`,children:u>3?"âœ“":"4"}),r.jsx("span",{className:"step-text",children:"Bedingungen"})]}),(0,r.jsxs)("div",{className:`progress-step ${u>=4?"active":""} ${u>4?"completed":""}`,children:[r.jsx("div",{className:`step-circle ${u>=4?"active":""} ${u>4?"completed":""}`,children:u>4?"âœ“":"5"}),r.jsx("span",{className:"step-text",children:"\xdcberpr\xfcfen"})]})]})})}),r.jsx("div",{className:"booking-step-content",children:(()=>{switch(u){case 0:return r.jsx(b,{selectedTreatments:e,toggleTreatment:A,onContinue:I});case 1:return r.jsx(f,{selectedTreatments:e,selectedDateTime:s,setSelectedDateTime:o,onBack:C,onContinue:I});case 2:return r.jsx(l,{customerInfo:d,setCustomerInfo:m,onBack:C,onContinue:I,isLoggedIn:N});case 3:return r.jsx(F,{selectedTreatments:e,onBack:C,onContinue:I});case 4:return r.jsx(S,{selectedTreatments:e,selectedDateTime:{date:s.date?s.date.toISOString():"",time:s.time||""},customerInfo:{firstName:d.fullName.split(" ")[0],lastName:d.fullName.split(" ").slice(1).join(" "),email:d.email,phone:d.phone},onBack:C,onConfirm:e=>{e&&e.length>0&&(console.log("Aktualisierte Treatments mit Rabatten empfangen:",e),n(e)),E()},error:p||void 0});case 5:return r.jsx(B,{selectedTreatments:e,selectedDateTime:{date:s.date,time:s.time||""},customerInfo:d});default:return null}})()})]})})]}):(0,r.jsxs)("section",{className:"section section-booking",children:[(0,r.jsxs)(a.default,{href:"/",className:"home-button",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),r.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Home"]}),r.jsx("div",{className:"container center-text",children:r.jsx("span",{className:"subheading",children:"Termin Buchen"})}),r.jsx("div",{className:"container",children:r.jsx("div",{className:"booking-container",children:r.jsx($,{})})})]})}!function(e){e[e.TreatmentSelection=0]="TreatmentSelection",e[e.DateTimeSelection=1]="DateTimeSelection",e[e.CustomerForm=2]="CustomerForm",e[e.TreatmentTerms=3]="TreatmentTerms",e[e.Summary=4]="Summary",e[e.Confirmation=5]="Confirmation"}(s||(s={}))},4293:(e,n,t)=>{"use strict";t.d(n,{IJ:()=>a,N0:()=>u,NB:()=>o,VR:()=>l,g4:()=>d,getBlockedTimesForDate:()=>c,hS:()=>h,isTimeSlotBlocked:()=>m,wi:()=>i});var s=t(76),r=t(5920);async function i(e,n,t,i){try{console.log(`ðŸš« Sperre Datumsbereich: ${e} bis ${n} - Grund: ${t}`);let a=new Date(e),l=new Date(n);if(a>l)return{success:!1,error:"Startdatum muss vor Enddatum liegen"};let o=Math.ceil((l.getTime()-a.getTime())/864e5)+1;if(o>365)return{success:!1,error:"Maximal 365 Tage k\xf6nnen gleichzeitig gesperrt werden"};let d=0,m=0,u=[],g=new Date(a);for(;g<=l;){let e=g.toISOString().split("T")[0],n=await c(e);if(n.find(e=>e.isFullDay))console.log(`âš ï¸ Tag ${e} bereits gesperrt - \xfcberspringe`),m++,u.push(`${e} bereits gesperrt`);else{for(let e of n)!e.isFullDay&&e.id&&await (0,s.oe)((0,s.doc)(r.db,"blocked_times",e.id));await (0,s.ET)((0,s.hJ)(r.db,"blocked_times"),{date:e,isFullDay:!0,reason:t,createdAt:s.Timestamp.now(),createdBy:i}),d++,console.log(`âœ… Tag ${e} erfolgreich gesperrt`)}g.setDate(g.getDate()+1)}if(0===d)return{success:!1,error:`Alle ${o} Tage waren bereits gesperrt`,blockedDays:0};if(m>0)return{success:!0,error:`${d}/${o} Tage gesperrt. ${m} bereits gesperrt: ${u.slice(0,3).join(", ")}${u.length>3?"...":""}`,blockedDays:d};return{success:!0,blockedDays:d}}catch(e){return console.error("âŒ Fehler beim Sperren des Datumsbereichs:",e),{success:!1,error:"Fehler beim Sperren des Datumsbereichs"}}}async function a(e,n,t){try{console.log(`ðŸš« Sperre ganzen Tag: ${e} - Grund: ${n}`);let i=await c(e);if(i.find(e=>e.isFullDay))return{success:!1,error:"Dieser Tag ist bereits vollst\xe4ndig gesperrt"};for(let e of i)!e.isFullDay&&e.id&&await (0,s.oe)((0,s.doc)(r.db,"blocked_times",e.id));return await (0,s.ET)((0,s.hJ)(r.db,"blocked_times"),{date:e,isFullDay:!0,reason:n,createdAt:s.Timestamp.now(),createdBy:t}),console.log(`âœ… Ganzer Tag erfolgreich gesperrt: ${e}`),{success:!0}}catch(e){return console.error("âŒ Fehler beim Sperren des ganzen Tags:",e),{success:!1,error:"Fehler beim Sperren des Tages"}}}async function l(e,n,t,i,a){try{console.log(`ðŸš« Sperre Zeitraum: ${e} ${n}-${t} - Grund: ${i}`);let l=await c(e);if(l.find(e=>e.isFullDay))return{success:!1,error:"Dieser Tag ist bereits vollst\xe4ndig gesperrt"};if(l.some(e=>{if(e.isFullDay||!e.startTime||!e.endTime)return!1;let s=g(e.startTime),r=g(e.endTime),i=g(n),a=g(t);return i<r&&a>s}))return{success:!1,error:"Zeitraum \xfcberschneidet sich mit bestehender Sperrung"};return await (0,s.ET)((0,s.hJ)(r.db,"blocked_times"),{date:e,startTime:n,endTime:t,isFullDay:!1,reason:i,createdAt:s.Timestamp.now(),createdBy:a}),console.log(`âœ… Zeitraum erfolgreich gesperrt: ${e} ${n}-${t}`),{success:!0}}catch(e){return console.error("âŒ Fehler beim Sperren des Zeitraums:",e),{success:!1,error:"Fehler beim Sperren des Zeitraums"}}}async function o(e){try{return console.log(`âœ… Hebe Sperrung auf: ${e}`),await (0,s.oe)((0,s.doc)(r.db,"blocked_times",e)),console.log(`âœ… Sperrung erfolgreich aufgehoben: ${e}`),{success:!0}}catch(e){return console.error("âŒ Fehler beim Aufheben der Sperrung:",e),{success:!1,error:"Fehler beim Aufheben der Sperrung"}}}async function c(e){try{let n=(0,s.IO)((0,s.hJ)(r.db,"blocked_times"),(0,s.ar)("date","==",e)),t=await (0,s.PL)(n),i=[];return t.forEach(e=>{i.push({id:e.id,...e.data()})}),i.sort((e,n)=>{let t=e.createdAt?.toDate?.()?.getTime()||0;return(n.createdAt?.toDate?.()?.getTime()||0)-t}),i}catch(n){if(console.error("âŒ Fehler beim Abrufen der gesperrten Zeiten:",n),n.message?.includes("index")){console.warn("âš ï¸ Firebase Index wird ben\xf6tigt. Verwende einfache Abfrage...");try{let n=await (0,s.PL)((0,s.hJ)(r.db,"blocked_times")),t=[];return n.forEach(n=>{let s={id:n.id,...n.data()};s.date===e&&t.push(s)}),t}catch(e){console.error("âŒ Auch Fallback-Abfrage fehlgeschlagen:",e)}}return[]}}async function d(e,n){try{let t=(0,s.IO)((0,s.hJ)(r.db,"blocked_times"),(0,s.ar)("date",">=",e),(0,s.ar)("date","<=",n)),i=await (0,s.PL)(t),a=[];return i.forEach(e=>{a.push({id:e.id,...e.data()})}),a.sort((e,n)=>{if(e.date!==n.date)return e.date.localeCompare(n.date);let t=e.createdAt?.toDate?.()?.getTime()||0;return(n.createdAt?.toDate?.()?.getTime()||0)-t}),a}catch(t){if(console.error("âŒ Fehler beim Abrufen der gesperrten Zeiten f\xfcr Bereich:",t),t.message?.includes("index")){console.warn("âš ï¸ Firebase Index wird ben\xf6tigt. Verwende Fallback...");try{let t=await (0,s.PL)((0,s.hJ)(r.db,"blocked_times")),i=[];return t.forEach(t=>{let s={id:t.id,...t.data()};s.date>=e&&s.date<=n&&i.push(s)}),i}catch(e){console.error("âŒ Fallback-Abfrage fehlgeschlagen:",e)}}return[]}}async function m(e,n){try{let t=await c(e);if(t.some(e=>e.isFullDay))return!0;let s=g(n);return t.some(e=>{if(e.isFullDay||!e.startTime||!e.endTime)return!1;let n=g(e.startTime),t=g(e.endTime);return s>=n&&s<t})}catch(e){return console.error("âŒ Fehler beim Pr\xfcfen der Zeitslot-Sperrung:",e),!1}}async function u(e){try{return(await c(e)).some(e=>e.isFullDay)}catch(e){return console.error("âŒ Fehler beim Pr\xfcfen der Ganztags-Sperrung:",e),!1}}function g(e){let[n,t]=e.split(":").map(Number);return 60*n+t}async function h(){try{console.log("\uD83D\uDCCB Lade alle gesperrten Zeiten...");let e=await (0,s.PL)((0,s.hJ)(r.db,"blocked_times")),n=[];return e.forEach(e=>{n.push({id:e.id,...e.data()})}),console.log(`ðŸ“‹ ${n.length} gesperrte Zeiten gefunden, sortiere manuell...`),n.sort((e,n)=>{if(e.date!==n.date)return e.date.localeCompare(n.date);let t=e.createdAt?.toDate?.()?.getTime()||0;return(n.createdAt?.toDate?.()?.getTime()||0)-t}),console.log(`âœ… Alle gesperrten Zeiten sortiert: ${n.length} Eintr\xe4ge`),n}catch(e){return console.error("âŒ Fehler beim Abrufen aller gesperrten Zeiten:",e),e.message?.includes("index")&&(console.warn("âš ï¸ Firebase Index-Problem erkannt. Das ist normal beim ersten Mal."),console.info("\uD83D\uDCA1 Firebase erstellt automatisch Indizes im Hintergrund. Bitte warten Sie einige Minuten.")),[]}}},8679:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>i,metadata:()=>r});var s=t(9510);t(7300);let r={title:"Termin Buchen | Sheen Berlin",description:"Buchen Sie Ihren Termin f\xfcr Microblading, Lash Lifting und andere Beauty-Behandlungen bei Sheen Berlin."};function i({children:e}){return s.jsx(s.Fragment,{children:e})}},1232:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>s});let s=(0,t(8570).createProxy)(String.raw`/Users/sbehaein/Desktop/Sheenweb2 Versionen/Version mit login (18.03.2025)/src/app/booking/page.tsx#default`)},7300:()=>{},400:()=>{},3805:()=>{}};var n=require("../../webpack-runtime.js");n.C(e);var t=e=>n(n.s=e),s=n.X(0,[628,46,226,187,920,365,669],()=>t(6207));module.exports=s})();